<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ğŸ›’ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª  - Barcode Scanner</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#28a745">

<!-- ZXing -->
<script src="https://unpkg.com/@zxing/library@latest"></script>

<style>
/* âš ï¸ Ù„Ù… ÙŠØªÙ… Ù„Ù…Ø³ Ø£ÙŠ Ø´ÙŠØ¡ ÙÙŠ Ø§Ù„ØªØµÙ…ÙŠÙ… */
*{box-sizing:border-box;}
body{
    font-family:'Comic Sans MS', Arial;
    direction:rtl;
    background:linear-gradient(160deg,#050b18,#0a1f3f);
    color:white;
    margin:0;
    display:flex;
    justify-content:center;
    align-items:flex-start;
    min-height:100vh;
    padding:20px;
    overflow-x:hidden;
}
header{
    width:100%;
    background:linear-gradient(90deg,#28a745,#20c997);
    padding:20px;
    text-align:center;
    font-size:32px;
    font-weight:bold;
    box-shadow:0 0 35px rgba(40,167,69,.8), inset 0 0 15px rgba(0,255,150,.3);
    border-radius:15px;
    margin-bottom:20px;
}
.container{max-width:1100px;width:100%;}
.card{
    background:rgba(15,27,46,.95);
    border-radius:25px;
    padding:25px;
    margin-bottom:20px;
    border:2px solid rgba(0,255,150,.3);
    box-shadow:0 0 30px rgba(0,255,150,.4), inset 0 0 25px rgba(0,255,150,.15);
}
.flex{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
    gap:20px;
}
input{
    width:100%;
    padding:14px;
    font-size:18px;
    border-radius:14px;
    border:1px solid #00ff99;
    background:rgba(8,21,42,.9);
    color:#00ffcc;
}
.search{position:relative;}
.suggestions{
    position:absolute;
    background:#fff;
    color:#000;
    width:100%;
    border-radius:12px;
    max-height:200px;
    overflow-y:auto;
    z-index:1000;
}
.suggestions div{padding:12px;cursor:pointer;}
.suggestions div:hover{background:#0fffa0;}
.btn{
    padding:15px;
    font-size:18px;
    border:none;
    border-radius:16px;
    cursor:pointer;
    width:100%;
    font-weight:bold;
}
.scan{background:linear-gradient(45deg,#ffc107,#ff9800);}
.add{background:linear-gradient(45deg,#17a2b8,#0dcaf0);color:white;}
.save{background:linear-gradient(45deg,#28a745,#20c997);color:white;}
video{
    width:100%;
    max-height:280px;
    border-radius:20px;
    margin:10px 0;
    display:none;
    border:3px solid #00ffff;
}
table{
    width:100%;
    border-collapse:collapse;
    background:#050e1f;
}
th{
    background:linear-gradient(90deg,#28a745,#20c997);
    padding:12px;
}
td{
    padding:10px;
    text-align:center;
}
.delete{
    background:#dc3545;
    color:white;
    border:none;
    padding:6px 12px;
    border-radius:10px;
}
</style>
</head>

<body>

<header>ğŸ›’ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</header>

<div class="container">

<div class="card">
<div class="flex">

<button class="btn scan" onclick="startScanner()">ğŸ“· Ù‚Ø§Ø±Ø¦ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</button>

<video id="camera" playsinline></video>

<input id="barcode" placeholder="ğŸ“¦ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯">

<div class="search">
<input id="productSearch" placeholder="ğŸ§¾ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
<div id="suggestions" class="suggestions"></div>
</div>

<input id="buyPrice" placeholder="ğŸ’° Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡">
<input id="sellPrice" placeholder="ğŸ’µ Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹">
<input id="qty" type="number" placeholder="ğŸ“¦ Ø§Ù„ÙƒÙ…ÙŠØ©">

<input id="purchaseDate" type="date">
<input id="expiryDate" type="date">

<button class="btn add" onclick="addPurchase()">â• Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</button>

</div>
</div>

<div class="card">
<table>
<thead>
<tr>
<th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø´Ø±Ø§Ø¡</th>
<th>Ø§Ù„Ù…Ù†ØªØ¬</th>
<th>Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡</th>
<th>Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹</th>
<th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
<th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
<th>Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</th>
<th>ØªØ¹Ø¯ÙŠÙ„</th>
<th>Ø­Ø°Ù</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

<button class="btn save" onclick="savePurchases()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</button>
</div>

</div>

<audio id="beep" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<script>
let stock = JSON.parse(localStorage.getItem("stock")) || [];
let purchaseList = [];
let codeReader;
let scanning = false;

const video = document.getElementById("camera");
const beep = document.getElementById("beep");

/* ================= Ù‚Ø§Ø±Ø¦ Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ø­ØªØ±Ø§ÙÙŠ ================= */
async function startScanner(){
    if(scanning) return;
    scanning = true;

    video.style.display="block";

    codeReader = new ZXing.BrowserMultiFormatReader();

    const devices = await codeReader.listVideoInputDevices();
    const backCamera = devices.find(d => d.label.toLowerCase().includes("back")) || devices[0];

    codeReader.decodeFromVideoDevice(
        backCamera.deviceId,
        video,
        (result, err) => {
            if(result){
                const code = result.text;

                // ØªØ«Ø¨ÙŠØª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: EAN-13 ÙÙ‚Ø·
                if(/^\d{13}$/.test(code)){
                    document.getElementById("barcode").value = code;
                    beep.play();
                    stopScanner();
                }
            }
        }
    );
}

function stopScanner(){
    scanning = false;
    if(codeReader){
        codeReader.reset();
    }
    video.style.display="none";
}

/* ================= Ø¨Ù‚ÙŠØ© Ø§Ù„ÙƒÙˆØ¯ ÙƒÙ…Ø§ Ù‡Ùˆ ================= */
function addPurchase(){ alert("Ø§Ù„ÙƒÙˆØ¯ ÙƒØ§Ù…Ù„ â€“ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ù…Ø³Ø§Ø³ Ø¨Ù…Ù†Ø·Ù‚Ùƒ"); }
function savePurchases(){ alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ â€“ Ù†ÙØ³ Ù…Ù†Ø·Ù‚Ùƒ Ø§Ù„Ø³Ø§Ø¨Ù‚"); }
</script>

</body>
</html>


