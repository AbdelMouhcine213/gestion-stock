<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ›’ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</title>

<style>
body{
    margin:0;
    font-family:'Comic Sans MS', Arial;
    direction:rtl;
    background:#050b18;
    color:white;
}
header{
    background:#17a2b8;
    padding:20px;
    text-align:center;
    font-size:28px;
    box-shadow:0 0 20px #17a2b8;
}
.container{
    max-width:1000px;
    margin:auto;
    padding:20px;
}
.card{
    background:#0f1b2e;
    border-radius:20px;
    padding:20px;
    box-shadow:0 0 15px rgba(0,255,255,.4);
}
input{
    width:100%;
    padding:14px;
    font-size:18px;
    border-radius:10px;
    border:none;
    margin-bottom:10px;
}
button{
    width:100%;
    padding:14px;
    font-size:18px;
    border:none;
    border-radius:12px;
    cursor:pointer;
    margin-bottom:10px;
}
.scan{background:#ffc107;color:black;}
.switch{background:#6f42c1;color:white;}
.save{background:#28a745;color:white;}

video{
    width:100%;
    border-radius:15px;
    margin-bottom:10px;
}
.frame{
    border:3px solid #00ffff;
    border-radius:15px;
    padding:5px;
    box-shadow:0 0 15px #00ffff;
}
.flex{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
}
.flex input{
    flex:1;
}
</style>

<!-- Ù…ÙƒØªØ¨Ø© ZXing Ø§Ù„Ø±Ø³Ù…ÙŠØ© -->
<script src="https://unpkg.com/@zxing/library@latest"></script>
</head>

<body>

<header>ğŸ›’ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</header>

<div class="container">
<div class="card">

<button class="scan" onclick="startScanner()">ğŸ“· ØªØ´ØºÙŠÙ„ Ù‚Ø§Ø±Ø¦ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</button>
<button class="switch" onclick="switchCamera()">ğŸ”„ ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</button>

<div class="frame">
    <video id="video"></video>
</div>

<input id="barcode" placeholder="ğŸ“¦ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ (ÙŠÙÙ‚Ø±Ø£ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§)">
<input id="name" placeholder="ğŸ§¾ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">

<div class="flex">
    <input id="buy" type="number" placeholder="ğŸ’° Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡">
    <input id="sell" type="number" placeholder="ğŸ’µ Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹">
</div>

<div class="flex">
    <input id="qty" type="number" placeholder="ğŸ“¦ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø£ØµÙ„ÙŠØ©">
    <input id="qtyLeft" type="number" placeholder="ğŸ“¦ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©">
</div>

<div class="flex">
    <input id="buyDate" type="date">
    <input id="expDate" type="date">
</div>

<button class="save" onclick="save()">ğŸ’¾ Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</button>

</div>
</div>

<audio id="beep" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<script>
let stock = JSON.parse(localStorage.getItem("stock")) || [];
let codeReader = new ZXing.BrowserMultiFormatReader();
let currentDeviceId = null;
let video = document.getElementById("video");
let beep = document.getElementById("beep");

/* ================= ØªØ´ØºÙŠÙ„ Ø§Ù„Ù‚Ø§Ø±Ø¦ ================= */
async function startScanner(){
    const devices = await ZXing.BrowserCodeReader.listVideoInputDevices();
    if(!devices.length){
        alert("Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒØ§Ù…ÙŠØ±Ø§");
        return;
    }
    currentDeviceId = devices[devices.length - 1].deviceId;
    scan();
}

function scan(){
    codeReader.decodeFromVideoDevice(
        currentDeviceId,
        video,
        (result, err) => {
            if(result){
                barcode.value = result.text;
                beep.play();
                codeReader.reset();
            }
        }
    );
}

/* ================= ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ================= */
async function switchCamera(){
    const devices = await ZXing.BrowserCodeReader.listVideoInputDevices();
    if(devices.length < 2){
        alert("Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒØ§Ù…ÙŠØ±Ø§ Ø«Ø§Ù†ÙŠØ©");
        return;
    }
    currentDeviceId =
        currentDeviceId === devices[0].deviceId
        ? devices[1].deviceId
        : devices[0].deviceId;

    codeReader.reset();
    scan();
}

/* ================= Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬ ================= */
function save(){
    if(!barcode.value || !name.value || !qty.value){
        alert("âŒ Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©");
        return;
    }

    let item = {
        barcode: barcode.value,
        name: name.value,
        buy: +buy.value || 0,
        sell: +sell.value || 0,
        qtyOriginal: +qty.value,
        qtyLeft: qtyLeft.value ? +qtyLeft.value : +qty.value,
        buyDate: buyDate.value,
        expDate: expDate.value
    };

    stock.push(item);
    localStorage.setItem("stock", JSON.stringify(stock));

    alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬ ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†");

    document.querySelectorAll("input").forEach(i=>i.value="");
}
</script>

</body>
</html>
