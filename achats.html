<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ›’ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</title>

<style>
*{box-sizing:border-box;}
body{
    font-family:Arial;
    direction:rtl;
    background:#0a1f3f;
    color:white;
    margin:0;
    padding:15px;
}

header{
    background:#28a745;
    padding:15px;
    text-align:center;
    font-size:28px;
    border-radius:12px;
    margin-bottom:15px;
}

.container{
    display:grid;
    grid-template-columns:220px 1fr;
    gap:15px;
}

/* ===== Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØµÙˆØ± ===== */
.images{
    background:#08152a;
    border-radius:15px;
    padding:10px;
    overflow-y:auto;
    max-height:80vh;
}

.img-item{
    border:2px solid #00ff99;
    border-radius:12px;
    margin-bottom:10px;
    padding:5px;
    cursor:pointer;
    text-align:center;
}

.img-item img{
    width:100%;
    height:120px;
    object-fit:contain;
    background:#fff;
    border-radius:10px;
}

.img-item span{
    display:block;
    margin-top:5px;
    font-size:14px;
    color:#00ffcc;
}

/* ===== Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª ===== */
.card{
    background:#08152a;
    padding:15px;
    border-radius:15px;
}

input,button{
    width:100%;
    padding:10px;
    margin:5px 0;
    border-radius:10px;
    border:none;
    font-size:16px;
}

input{
    background:#000;
    color:#0ff;
    border:1px solid #00ff99;
}

button{
    background:#17a2b8;
    color:white;
    cursor:pointer;
}

button:hover{opacity:.8;}

table{
    width:100%;
    border-collapse:collapse;
    margin-top:10px;
}

th,td{
    padding:8px;
    border-bottom:1px solid #123;
    text-align:center;
}
th{background:#28a745;}

</style>
</head>

<body>

<header>ğŸ›’ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</header>

<div class="container">

<!-- ===== Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØµÙˆØ± ===== -->
<div class="images" id="imageList"></div>

<!-- ===== Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ===== -->
<div class="card">

<input id="barcode" placeholder="ğŸ“¦ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯">
<input id="product" placeholder="ğŸ§¾ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
<input id="buy" placeholder="ğŸ’° Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡">
<input id="sell" placeholder="ğŸ’µ Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹">
<input id="qty" type="number" placeholder="ğŸ“¦ Ø§Ù„ÙƒÙ…ÙŠØ©">
<input id="date" type="date">
<input id="expiry" type="date">

<label>ğŸ“· ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬</label>
<input type="file" id="imageInput" accept="image/*">

<button onclick="addPurchase()">â• Ø¥Ø¶Ø§ÙØ©</button>

<table>
<thead>
<tr>
<th>Ø§Ù„Ù…Ù†ØªØ¬</th>
<th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
<th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
<th>Ø­Ø°Ù</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

<button onclick="save()">ğŸ’¾ Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</button>

</div>
</div>

<script>
let stock = JSON.parse(localStorage.getItem("stock")) || [];
let purchases = [];
const tbody = document.getElementById("tbody");

/* ===== Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± ===== */
function renderImages(){
    const list=document.getElementById("imageList");
    list.innerHTML="";
    stock.forEach(p=>{
        if(!p.image) return;
        let div=document.createElement("div");
        div.className="img-item";
        div.innerHTML=`
            <img src="${p.image}">
            <span>${p.name}</span>
        `;
        div.onclick=()=>{
            product.value=p.name;
            sell.value=p.sell;
            barcode.value=p.barcode||"";
        };
        list.appendChild(div);
    });
}
renderImages();

/* ===== Ø¥Ø¶Ø§ÙØ© ===== */
function addPurchase(){
    let imgFile=document.getElementById("imageInput").files[0];
    let reader=new FileReader();

    reader.onload=function(){
        purchases.push({
            name:product.value,
            buy:+buy.value,
            sell:+sell.value,
            qty:+qty.value,
            date:date.value,
            expiry:expiry.value,
            barcode:barcode.value,
            image:reader.result
        });
        render();
    }

    if(imgFile) reader.readAsDataURL(imgFile);
    else reader.onload();
}

/* ===== Ø¬Ø¯ÙˆÙ„ ===== */
function render(){
    tbody.innerHTML="";
    purchases.forEach((p,i)=>{
        tbody.innerHTML+=`
        <tr>
        <td>${p.name}</td>
        <td>${p.qty}</td>
        <td>${p.qty*p.buy}</td>
        <td><button onclick="del(${i})">ğŸ—‘ï¸</button></td>
        </tr>`;
    });
}

function del(i){
    purchases.splice(i,1);
    render();
}

/* ===== Ø­ÙØ¸ ===== */
function save(){
    purchases.forEach(p=>{
        let s=stock.find(x=>x.name===p.name);
        if(s){
            s.qtyLeft+=p.qty;
            s.qtyOriginal+=p.qty;
            if(p.image) s.image=p.image;
        }else{
            stock.push({
                name:p.name,
                buy:p.buy,
                sell:p.sell,
                qtyOriginal:p.qty,
                qtyLeft:p.qty,
                barcode:p.barcode,
                expiry:p.expiry,
                date:p.date,
                image:p.image
            });
        }
    });
    localStorage.setItem("stock",JSON.stringify(stock));
    alert("âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸");
    purchases=[];
    render();
    renderImages();
}
</script>

</body>
</html>
