<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ğŸ›’ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª - Barcode Scanner</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#28a745">
<style>
*{box-sizing:border-box;}

body{
    font-family:'Comic Sans MS', Arial;
    direction:rtl;
    background:linear-gradient(160deg,#050b18,#0a1f3f);
    color:white;
    margin:0;
    display:flex;
    justify-content:center;
    align-items:flex-start;
    min-height:100vh;
    padding:20px;
    overflow-x:hidden;
}

/* ===== Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ===== */
header{
    width:100%;
    background:linear-gradient(90deg,#28a745,#20c997);
    padding:20px;
    text-align:center;
    font-size:32px;
    font-weight:bold;
    box-shadow:0 0 35px rgba(40,167,69,.8), inset 0 0 15px rgba(0,255,150,.3);
    border-radius:15px;
    margin-bottom:20px;
}

/* ===== Ø§Ù„Ø­Ø§ÙˆÙŠØ© ===== */
.container{
    max-width:1100px;
    width:100%;
}

/* ===== Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª ===== */
.card{
    background:rgba(15,27,46,.95);
    border-radius:25px;
    padding:25px;
    margin-bottom:20px;
    border:2px solid rgba(0,255,150,.3);
    box-shadow:
        0 0 30px rgba(0,255,150,.4),
        inset 0 0 25px rgba(0,255,150,.15);
}

/* ===== Ø´Ø¨ÙƒØ© Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª ===== */
.flex{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
    gap:20px;
}

/* ===== Ø§Ù„Ø­Ù‚ÙˆÙ„ ===== */
input{
    width:100%;
    padding:14px;
    font-size:18px;
    border-radius:14px;
    border:1px solid #00ff99;
    background:rgba(8,21,42,.9);
    color:#00ffcc;
    outline:none;
    transition:.3s;
}

input::placeholder{
    color:#88bfcf;
}

input:focus{
    box-shadow:0 0 15px #00ff99, inset 0 0 10px #00ff99;
    border-color:#00ff99;
}

/* ===== Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª ===== */
.search{ position:relative; }
.suggestions{
    position:absolute;
    background:#ffffff;
    color:black;
    width:100%;
    border-radius:12px;
    max-height:200px;
    overflow-y:auto;
    z-index:1000;
    box-shadow:0 0 15px rgba(0,255,150,.5);
}
.suggestions div{
    padding:12px;
    cursor:pointer;
}
.suggestions div:hover{ background:#0fffa0; color:#000; }

/* ===== Ø§Ù„Ø£Ø²Ø±Ø§Ø± ===== */
.btn{
    padding:15px;
    font-size:18px;
    border:none;
    border-radius:16px;
    cursor:pointer;
    width:100%;
    font-weight:bold;
    transition:.25s;
    box-shadow:0 0 15px rgba(0,255,150,.4), inset 0 0 10px rgba(0,255,150,.2);
}

.scan{
    background:linear-gradient(45deg,#ffc107,#ff9800);
    color:black;
}
.add{
    background:linear-gradient(45deg,#17a2b8,#0dcaf0);
    color:white;
}
.save{
    background:linear-gradient(45deg,#28a745,#20c997);
    color:white;
}

.btn:hover{
    transform:scale(1.05);
    box-shadow:0 0 20px rgba(0,255,150,.6), inset 0 0 15px rgba(0,255,150,.25);
}

/* ===== Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ===== */
video{
    width:100%;
    max-height:280px;
    border-radius:20px;
    margin:10px 0;
    display:none;
    border:3px solid #00ffff;
    box-shadow:0 0 30px #00ffff, inset 0 0 20px #00ffff;
}

/* ===== Ø§Ù„Ø¬Ø¯ÙˆÙ„ ===== */
table{
    width:100%;
    border-collapse:collapse;
    background:#050e1f;
    border-radius:15px;
    overflow:hidden;
    font-size:16px;
}

th{
    background:linear-gradient(90deg,#28a745,#20c997);
    padding:12px;
    text-align:center;
}

td{
    padding:10px;
    border-bottom:1px solid #123;
    text-align:center;
}

tr:hover{
    background:rgba(0,255,150,.1);
}

/* ===== Ø­Ø°Ù ===== */
.delete{
    background:#dc3545;
    color:white;
    border:none;
    padding:6px 12px;
    border-radius:10px;
    cursor:pointer;
    box-shadow:0 0 10px rgba(255,0,0,.5);
}

/* ===== Ø§Ù„Ù‡Ø§ØªÙ ===== */
@media(max-width:600px){
    header{ font-size:24px; }
}
</style>
</head>
<body>

<header>ğŸ›’ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</header>

<div class="container">

<div class="flex">

    <button class="btn scan" onclick="toggleCamera()">ğŸ“· Ù‚Ø§Ø±Ø¦ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</button>
    <video id="camera"></video>

    <input id="barcode" placeholder="ğŸ“¦ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯">

    <div class="search">
        <input id="productSearch" placeholder="ğŸ§¾ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
        <div id="suggestions" class="suggestions"></div>
    </div>

    <input id="buyPrice" placeholder="ğŸ’° Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡">
    <input id="sellPrice" placeholder="ğŸ’µ Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹">
    <input id="qty" type="number" placeholder="ğŸ“¦ Ø§Ù„ÙƒÙ…ÙŠØ©">

    <input id="purchaseDate" type="date">
    <input id="expiryDate" type="date">

    <button class="btn add" onclick="addPurchase()">â• Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</button>

</div>
</div>

<div class="card">
<table>
<thead>
<tr>
<th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø´Ø±Ø§Ø¡</th>
<th>Ø§Ù„Ù…Ù†ØªØ¬</th>
<th>Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡</th>
<th>Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹</th>
<th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
<th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
<th>Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</th>
<th>ØªØ¹Ø¯ÙŠÙ„</th>
<th>Ø­Ø°Ù</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

<button class="btn save" onclick="savePurchases()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</button>
</div>

</div>

<audio id="beep" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<script>
let stock = JSON.parse(localStorage.getItem("stock")) || [];
let purchaseList = [];
const tbody = document.getElementById("tbody");
const productInput = document.getElementById("productSearch");
const suggestions = document.getElementById("suggestions");
const beep = document.getElementById("beep");
let video = document.getElementById("camera");
let stream = null;
let scanning = false;

/* ================= ØªØ´ØºÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ================= */
async function toggleCamera(){
    if(scanning){
        stopScanner();
    } else {
        startScanner();
    }
}

/* ================= Ù‚Ø§Ø±Ø¦ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ ================= */
async function startScanner(){
    if(!('BarcodeDetector' in window)){
        alert("Ø§Ù„Ù‡Ø§ØªÙ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ù‚Ø§Ø±Ø¦ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯");
        return;
    }

    stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
    video.srcObject = stream;
    video.play();
    video.style.display="block";
    scanning = true;

    const detector = new BarcodeDetector({formats:['ean_13','code_128']});

    async function scanLoop(){
        if(!scanning) return;
        try{
            const codes = await detector.detect(video);
            if(codes.length>0){
                const code = codes[0].rawValue;
                if(code.length>=12){
                    document.getElementById("barcode").value = code;
                    beep.play();
                    let p = stock.find(x=>x.barcode===code);
                    if(p){
                        productInput.value = p.name;
                        document.getElementById("sellPrice").value = p.sell;
                    }
                    stopScanner();
                    return;
                }
            }
        } catch(e){}
        requestAnimationFrame(scanLoop);
    }

    scanLoop();
}

function stopScanner(){
    scanning = false;
    if(stream){
        stream.getTracks().forEach(t=>t.stop());
    }
    video.style.display="none";
}

/* ================= Ø¥ÙƒÙ…Ø§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠ ================= */
productInput.addEventListener("input", function(){
    let value = this.value.trim().toLowerCase();
    suggestions.innerHTML = "";
    if(!value) return;

    stock.forEach(p=>{
        if(p.name.toLowerCase().startsWith(value) && p.qtyLeft>0){
            let div=document.createElement("div");
            div.textContent=p.name+" (Ù…ØªØ¨Ù‚ÙŠ: "+p.qtyLeft+")";
            div.onclick=()=>{
                productInput.value=p.name;
                document.getElementById("sellPrice").value=p.sell;
                suggestions.innerHTML="";
            };
            suggestions.appendChild(div);
        }
    });
});

/* ================= Ø¥Ø¶Ø§ÙØ© Ù…Ø´ØªØ±ÙŠØ§Øª ================= */
function addPurchase(){
    const purchaseDate = document.getElementById("purchaseDate").value;
    const productName = productInput.value;
    const buyPrice = Number(document.getElementById("buyPrice").value);
    const sellPrice = Number(document.getElementById("sellPrice").value);
    const qty = Number(document.getElementById("qty").value);
    const expiryDate = document.getElementById("expiryDate").value;
    const barcode = document.getElementById("barcode").value;

    if(!purchaseDate||!productName||!buyPrice||!sellPrice||!qty||!expiryDate){
        alert("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„"); return;
    }

    purchaseList.push({ purchaseDate, productName, buyPrice, sellPrice, qty, expiryDate, barcode });
    render();
    document.querySelectorAll("#barcode,#productSearch,#buyPrice,#sellPrice,#qty,#purchaseDate,#expiryDate").forEach(i=>i.value="");
}

function render(){
    tbody.innerHTML="";
    purchaseList.forEach((p,i)=>{
        let tr=document.createElement("tr");
        tr.innerHTML=`
<td>${p.purchaseDate}</td>
<td>${p.productName}</td>
<td>${p.buyPrice}</td>
<td>${p.sellPrice}</td>
<td>${p.qty}</td>
<td>${p.buyPrice*p.qty}</td>
<td>${p.expiryDate}</td>
<td><button class="btn add" onclick="editPurchase(${i})">âœï¸</button></td>
<td><button class="btn delete" onclick="deletePurchase(${i})">ğŸ—‘ï¸</button></td>
        `;
        tbody.appendChild(tr);
    });
}

function editPurchase(i){
    let p = purchaseList[i];
    document.getElementById("purchaseDate").value=p.purchaseDate;
    productInput.value=p.productName;
    document.getElementById("buyPrice").value=p.buyPrice;
    document.getElementById("sellPrice").value=p.sellPrice;
    document.getElementById("qty").value=p.qty;
    document.getElementById("expiryDate").value=p.expiryDate;
    document.getElementById("barcode").value=p.barcode;
    purchaseList.splice(i,1);
    render();
}

function deletePurchase(i){
    purchaseList.splice(i,1);
    render();
}

/* ================= Ø­ÙØ¸ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ================= */
function savePurchases(){
    if(!purchaseList.length){ alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´ØªØ±ÙŠØ§Øª"); return; }

    purchaseList.forEach(p=>{
        let existing = stock.find(s=>s.name===p.productName);
        if(existing){
            existing.qtyOriginal += p.qty;
            existing.qtyLeft += p.qty;
            existing.buy = p.buyPrice;
            existing.sell = p.sellPrice;
            existing.expiry = p.expiryDate;
            existing.date = p.purchaseDate;
            if(p.barcode) existing.barcode = p.barcode;
        } else {
            stock.push({
                date:p.purchaseDate,
                name:p.productName,
                buy:p.buyPrice,
                sell:p.sellPrice,
                qtyOriginal:p.qty,
                qtyLeft:p.qty,
                expiry:p.expiryDate,
                barcode:p.barcode
            });
        }
    });

    localStorage.setItem("stock", JSON.stringify(stock));
    alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†");
    purchaseList=[];
    render();
}
</script>

</body>
</html>




