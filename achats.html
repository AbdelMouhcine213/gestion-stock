<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#28a745">
<style>
body{
    font-family:Arial;
    direction:rtl;
    background:#f4f6f8;
    margin:0;
}
header{
    background:#17a2b8;
    color:white;
    padding:15px;
    text-align:center;
    font-size:26px;
    font-weight:bold;
}
.container{ padding:20px; }
.inputs{
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    margin-bottom:15px;
}
.inputs input, .inputs select{
    padding:10px;
    font-size:15px;
}
.btn{
    padding:10px 15px;
    border:none;
    border-radius:5px;
    cursor:pointer;
    color:white;
}
.add{ background:#28a745; }
.save{ background:#007bff; }
table{
    width:100%;
    background:white;
    border-collapse:collapse;
}
th,td{
    border:1px solid #ddd;
    padding:8px;
    text-align:center;
}
th{
    background:#17a2b8;
    color:white;
}
.action{ background:#dc3545; }
.edit{ background:#ffc107; color:black; }
.product-img{ width:50px; height:50px; object-fit:cover; border-radius:5px; }
</style>
</head>

<body>

<header>Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</header>

<div class="container">

<div class="inputs">
    <input type="date" id="purchaseDate">
    <input type="text" id="productName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
    
    <!-- Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬ -->
    <input type="file" id="productImage" accept="image/*">

    <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© -->
    <select id="groupSelect" onchange="updateSubgroup()">
        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</option>
        <option value="Chocolat">Chocolat</option>
        <option value="Gaufrette">Gaufrette</option>
        <option value="GÃ¢teaux">GÃ¢teaux</option>
        <option value="Boisson">Boisson</option>
        <option value="Les Glaces">Les Glaces</option>
        <option value="Autres">Autres</option>
        <option value="Femme">Femme</option>
        <option value="Homme">Homme</option>
    </select>

    <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ© -->
    <select id="subgroupSelect">
        <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ©</option>
    </select>

    <input type="number" id="buyPrice" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡">
    <input type="number" id="sellPrice" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹">
    <input type="number" id="quantity" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
    <input type="date" id="expiryDate">
    <button class="btn add" onclick="addPurchase()">Ø¥Ø¶Ø§ÙØ©</button>
</div>

<table>
<thead>
<tr>
<th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø´Ø±Ø§Ø¡</th>
<th>Ø§Ù„Ù…Ù†ØªØ¬</th>
<th>Ø§Ù„ØµÙˆØ±Ø©</th>
<th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</th>
<th>Ø§Ù„ÙØ¦Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ©</th>
<th>Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡</th>
<th>Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹</th>
<th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
<th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
<th>Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</th>
<th>ØªØ¹Ø¯ÙŠÙ„</th>
<th>Ø­Ø°Ù</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

<br>
<button class="btn save" onclick="savePurchases()">Ø­ÙØ¸ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</button>

</div>

<script>
let purchaseList = [];
const tbody = document.getElementById("tbody");

// ØªØ¹Ø±ÙŠÙ Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„ÙØ±Ø¹ÙŠØ©
const subgroups = {
    Femme: ["Parfum","DÃ©odorant","Stick","Shampoing","CrÃ¨me","Autres"],
    Homme: ["Parfum","DÃ©odorant","Stick","Shampoing","CrÃ¨me","Autres"]
};

// ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ¦Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ©
function updateSubgroup(){
    const group = document.getElementById("groupSelect").value;
    const subgroupSelect = document.getElementById("subgroupSelect");
    subgroupSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ©</option>';
    if(subgroups[group]){
        subgroups[group].forEach(sg=>{
            let opt = document.createElement("option");
            opt.value = sg;
            opt.textContent = sg;
            subgroupSelect.appendChild(opt);
        });
    }
}

// Ø¥Ø¶Ø§ÙØ© Ø´Ø±Ø§Ø¡ Ø¬Ø¯ÙŠØ¯
function addPurchase(){
    let purchaseDate = document.getElementById("purchaseDate").value;
    let productName  = document.getElementById("productName").value;
    let buyPrice     = Number(document.getElementById("buyPrice").value);
    let sellPrice    = Number(document.getElementById("sellPrice").value);
    let quantity     = Number(document.getElementById("quantity").value);
    let expiryDate   = document.getElementById("expiryDate").value;
    let group        = document.getElementById("groupSelect").value;
    let subgroup     = document.getElementById("subgroupSelect").value;
    let imgInput     = document.getElementById("productImage");

    if(!purchaseDate || !productName || !buyPrice || !sellPrice || !quantity || !expiryDate || !group){
        alert("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙˆØ§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©");
        return;
    }

    let imgData = "";
    if(imgInput.files.length > 0){
        const reader = new FileReader();
        reader.onload = function(e){
            imgData = e.target.result;
            addPurchaseToList(imgData);
        }
        reader.readAsDataURL(imgInput.files[0]);
    } else {
        addPurchaseToList(imgData);
    }

    function addPurchaseToList(img){
        purchaseList.push({
            purchaseDate, productName, buyPrice, sellPrice, quantity, expiryDate,
            group, subgroup, img
        });
        render();
        clearInputs();
    }
}

// Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
function render(){
    tbody.innerHTML="";
    purchaseList.forEach((p,i)=>{
        let tr=document.createElement("tr");
        tr.innerHTML=`
<td>${p.purchaseDate}</td>
<td>${p.productName}</td>
<td>${p.img ? `<img src="${p.img}" class="product-img">` : ""}</td>
<td>${p.group}</td>
<td>${p.subgroup || ""}</td>
<td>${p.buyPrice}</td>
<td>${p.sellPrice}</td>
<td>${p.quantity}</td>
<td>${p.buyPrice * p.quantity}</td>
<td>${p.expiryDate}</td>
<td><button class="btn edit" onclick="editPurchase(${i})">âœï¸</button></td>
<td><button class="btn action" onclick="deletePurchase(${i})">ğŸ—‘ï¸</button></td>
        `;
        tbody.appendChild(tr);
    });
}

// ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù†ØµØ±
function editPurchase(i){
    let p = purchaseList[i];
    document.getElementById("purchaseDate").value = p.purchaseDate;
    document.getElementById("productName").value  = p.productName;
    document.getElementById("buyPrice").value     = p.buyPrice;
    document.getElementById("sellPrice").value    = p.sellPrice;
    document.getElementById("quantity").value     = p.quantity;
    document.getElementById("expiryDate").value   = p.expiryDate;
    document.getElementById("groupSelect").value  = p.group;
    updateSubgroup();
    document.getElementById("subgroupSelect").value = p.subgroup || "";
    purchaseList.splice(i,1);
    render();
}

// Ø­Ø°Ù Ø¹Ù†ØµØ±
function deletePurchase(i){
    purchaseList.splice(i,1);
    render();
}

// Ù…Ø³Ø­ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„Ø§Øª
function clearInputs(){
    document.querySelectorAll(".inputs input").forEach(i=>i.value="");
    document.getElementById("groupSelect").value = "";
    document.getElementById("subgroupSelect").innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ©</option>';
    document.getElementById("productImage").value = "";
}

// Ø­ÙØ¸ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† (Ù…Ø¹ Ø§Ù„ØµÙˆØ±Ø© ÙˆØ§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª)
function savePurchases(){
    if(!purchaseList.length){
        alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´ØªØ±ÙŠØ§Øª");
        return;
    }
    let stock = JSON.parse(localStorage.getItem("stock")) || [];
    purchaseList.forEach(p=>{
        let existing = stock.find(s => s.name === p.productName);
        if(existing){
            existing.qtyOriginal += p.quantity;
            existing.qtyLeft     += p.quantity;
            existing.buy          = p.buyPrice;
            existing.sell         = p.sellPrice;
            existing.expiry       = p.expiryDate;
            existing.date         = p.purchaseDate;
            existing.group        = p.group;
            existing.subgroup     = p.subgroup;
            existing.img          = p.img;
        }else{
            stock.push({
                date: p.purchaseDate,
                name: p.productName,
                buy: p.buyPrice,
                sell: p.sellPrice,
                qtyOriginal: p.quantity,
                qtyLeft: p.quantity,
                expiry: p.expiryDate,
                group: p.group,
                subgroup: p.subgroup,
                img: p.img
            });
        }
    });
    localStorage.setItem("stock", JSON.stringify(stock));
    alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø¨Ù†Ø¬Ø§Ø­ âœ…");
    purchaseList=[];
    render();
}
</script>

</body>
</html>
