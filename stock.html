<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{box-sizing:border-box}
body{margin:0;font-family:Arial;direction:rtl;background:#0a1f3f;color:white;padding:10px}
header{background:#28a745;padding:15px;text-align:center;font-size:28px;border-radius:12px;margin-bottom:15px}
.container{display:grid;grid-template-columns:250px 1fr;gap:15px}
.images{background:#08152a;border-radius:15px;padding:10px;overflow-y:auto;max-height:80vh}
.img-item{border:2px solid #00ff99;border-radius:12px;margin-bottom:10px;padding:5px;text-align:center}
.img-item img{width:100%;height:120px;object-fit:contain;background:#fff;border-radius:10px}
.img-item span{display:block;margin-top:5px;font-size:14px;color:#00ffcc}
.card{background:#08152a;padding:15px;border-radius:15px}
input,select,button{width:100%;padding:10px;margin:5px 0;border-radius:10px;border:none;font-size:16px}
input{background:#000;color:#0ff;border:1px solid #00ff99}
button{background:#17a2b8;color:white}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{padding:8px;border-bottom:1px solid #123;text-align:center}
th{background:#28a745}
.stockLabel{color:#0f0;font-weight:bold}
</style>
</head>
<body>

<header>ğŸ“¦ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</header>

<div class="container">

<div class="images" id="imageList"></div>

<div class="card">
<h3>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</h3>
<input id="barcode" placeholder="Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯">
<input id="product" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">

<select id="category">
<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</option>
<option>Ø§Ù„Ø­Ù„ÙˆÙŠØ§Øª</option>
<option>Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª</option>
<option>Ø§Ù„Ø¹Ø·ÙˆØ± Ø§Ù„Ø±Ø¬Ø§Ù„ÙŠØ©</option>
<option>Ø§Ù„Ø¹Ø·ÙˆØ± Ø§Ù„Ù†Ø³Ø§Ø¦ÙŠØ©</option>
<option>CosmÃ©tique</option>
<option>Autres</option>
</select>

<input id="buy" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡">
<input id="sell" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹">
<input id="qty" type="number" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
<input type="file" id="imageInput" accept="image/*">

<button onclick="addProduct()">â• Ø¥Ø¶Ø§ÙØ©</button>

<h3>Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h3>
<table>
<thead>
<tr>
<th>Ø§Ù„Ù…Ù†ØªØ¬</th>
<th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</th>
<th>Ø§Ù„Ø£ØµÙ„ÙŠØ©</th>
<th>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©</th>
<th>Ø§Ù„Ø¨ÙŠØ¹</th>
<th>Ø­Ø°Ù</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</div>
</div>

<script type="module">
import { db } from "./firebase.js";
import { ref, push, set, onValue, remove } from
"https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const stockRef = ref(db,"stock");
const tbody = document.getElementById("tbody");
const imageList = document.getElementById("imageList");

onValue(stockRef,snap=>{
 const data=snap.val()||{};
 tbody.innerHTML="";
 imageList.innerHTML="";
 Object.entries(data).forEach(([id,p])=>{
  if(p.image){
   let d=document.createElement("div");
   d.className="img-item";
   d.innerHTML=`<img src="${p.image}"><span>${p.name}</span>`;
   imageList.appendChild(d);
  }
  let tr=document.createElement("tr");
  tr.innerHTML=`
   <td>${p.name}</td>
   <td>${p.category}</td>
   <td>${p.qtyOriginal}</td>
   <td class="stockLabel">${p.qtyLeft}</td>
   <td>${p.sell}</td>
   <td><button onclick="del('${id}')">ğŸ—‘ï¸</button></td>`;
  tbody.appendChild(tr);
 });
});

window.addProduct=()=>{
 let reader=new FileReader();
 let file=imageInput.files[0];
 reader.onload=()=>{
  push(stockRef,{
   name:product.value,
   category:category.value,
   buy:+buy.value,
   sell:+sell.value,
   qtyOriginal:+qty.value,
   qtyLeft:+qty.value,
   barcode:barcode.value,
   image:reader.result
  });
  product.value=buy.value=sell.value=qty.value=barcode.value="";
 };
 if(file) reader.readAsDataURL(file);
};

window.del=(id)=>{
 if(confirm("Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ØŸ")) remove(ref(db,"stock/"+id));
};
</script>

</body>
</html>
