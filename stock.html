<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gestion Stock & POS</title>
<style>
*{box-sizing:border-box;}
body{margin:0;font-family:Arial;direction:rtl;background:#0a1f3f;color:white;padding:10px;}
header{background:#28a745;padding:15px;text-align:center;font-size:28px;border-radius:12px;margin-bottom:15px;}
.container{display:grid;grid-template-columns:250px 1fr;gap:15px;}

/* ===== Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØµÙˆØ± ===== */
.images{background:#08152a;border-radius:15px;padding:10px;overflow-y:auto;max-height:80vh;}
.img-item{border:2px solid #00ff99;border-radius:12px;margin-bottom:10px;padding:5px;cursor:pointer;text-align:center;}
.img-item img{width:100%;height:120px;object-fit:contain;background:#fff;border-radius:10px;}
.img-item span{display:block;margin-top:5px;font-size:14px;color:#00ffcc;}

/* ===== Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª ===== */
.card{background:#08152a;padding:15px;border-radius:15px;}
input,button,select{width:100%;padding:10px;margin:5px 0;border-radius:10px;border:none;font-size:16px;}
input{background:#000;color:#0ff;border:1px solid #00ff99;}
button{background:#17a2b8;color:white;cursor:pointer;}
button:hover{opacity:.8;}
table{width:100%;border-collapse:collapse;margin-top:10px;}
th,td{padding:8px;border-bottom:1px solid #123;text-align:center;}
th{background:#28a745;}
.stockLabel{color:#0f0;font-weight:bold;}
</style>
</head>
<body>

<header>ğŸ›’ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ÙˆØ§Ù„Ù…Ø®Ø²ÙˆÙ†</header>

<div class="container">
<!-- ===== Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØµÙˆØ± ===== -->
<div class="images" id="imageList"></div>

<!-- ===== Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ===== -->
<div class="card">
<h3>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h3>
<input id="barcode" placeholder="ğŸ“¦ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯">
<input id="product" placeholder="ğŸ§¾ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
<select id="categorySelect"></select>
<input id="newCategory" placeholder="Ø£Ø¯Ø®Ù„ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª">
<input id="buy" placeholder="ğŸ’° Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡">
<input id="sell" placeholder="ğŸ’µ Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹">
<input id="qty" type="number" placeholder="ğŸ“¦ Ø§Ù„ÙƒÙ…ÙŠØ©">
<input id="date" type="date">
<input id="expiry" type="date">
<label>ğŸ“· ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬</label>
<input type="file" id="imageInput" accept="image/*">
<button onclick="addPurchase()">â• Ø¥Ø¶Ø§ÙØ©</button>

<h3>Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ</h3>
<table>
<thead>
<tr>
<th>Ø§Ù„Ù…Ù†ØªØ¬</th>
<th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</th>
<th>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø£ØµÙ„ÙŠØ©</th>
<th>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©</th>
<th>Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹</th>
<th>ØªØ¹Ø¯ÙŠÙ„/Ø­Ø°Ù</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</div>
</div>

<script>
let stock = JSON.parse(localStorage.getItem("stock")) || [];
const tbody = document.getElementById("tbody");

// ===== Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© =====
let categories = ["Ø§Ù„Ø­Ù„ÙˆÙŠØ§Øª","Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª","Ø¹Ø·ÙˆØ± Ø±Ø¬Ø§Ù„ÙŠØ©","Ø¹Ø·ÙˆØ± Ù†Ø³Ø§Ø¦ÙŠØ©","CosmÃ©tique","TABAC"];

// ===== ØªØ­Ø¯ÙŠØ« Dropdown Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª =====
function updateCategoryDropdown(){
    const select = document.getElementById("categorySelect");
    select.innerHTML="";
    categories.forEach(cat=>{
        let opt = document.createElement("option");
        opt.value = cat;
        opt.textContent = cat;
        select.appendChild(opt);
    });
}
updateCategoryDropdown();

// ===== Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± ÙˆØ§Ù„Ù…Ø®Ø²ÙˆÙ† =====
function renderImages(){
    const list = document.getElementById("imageList");
    list.innerHTML="";
    stock.forEach((p,i)=>{
        if(!p.image) return;
        let div = document.createElement("div");
        div.className="img-item";
        div.innerHTML=`
            <img src="${p.image}">
            <span>${p.name} (${p.category})</span>
        `;
        div.onclick = ()=>{ 
            document.getElementById("product").value = p.name;
            document.getElementById("sell").value = p.sell;
            document.getElementById("buy").value = p.buy;
            document.getElementById("barcode").value = p.barcode || "";
            document.getElementById("categorySelect").value = p.category;
        };
        list.appendChild(div);
    });
    renderStockTable();
}

// ===== Ø¥Ø¶Ø§ÙØ© Ø´Ø±Ø§Ø¡ =====
function addPurchase(){
    let prodName = document.getElementById("product").value.trim();
    let prodCategory = document.getElementById("newCategory").value.trim() || document.getElementById("categorySelect").value;
    let buyPrice = +document.getElementById("buy").value;
    let sellPrice = +document.getElementById("sell").value;
    let qtyValue = +document.getElementById("qty").value;
    let barcodeVal = document.getElementById("barcode").value;
    let dateVal = document.getElementById("date").value;
    let expiryVal = document.getElementById("expiry").value;
    let imgFile = document.getElementById("imageInput").files[0];

    if(!prodName || !prodCategory || !buyPrice || !sellPrice || !qtyValue){ alert("ğŸš« ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„"); return; }

    if(prodCategory && !categories.includes(prodCategory)) categories.push(prodCategory);
    updateCategoryDropdown();

    let reader = new FileReader();
    reader.onload = function(){
        const prod = {
            name: prodName,
            category: prodCategory,
            buy: buyPrice,
            sell: sellPrice,
            qtyOriginal: qtyValue,
            qtyLeft: qtyValue,
            date: dateVal,
            expiry: expiryVal,
            barcode: barcodeVal,
            image: reader.result || ""
        };

        // Ø¯Ù…Ø¬ Ø¥Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ Ù…ÙˆØ¬ÙˆØ¯
        let exist = stock.find(x=>x.name===prod.name && x.category===prod.category);
        if(exist){
            exist.qtyOriginal += prod.qtyOriginal;
            exist.qtyLeft += prod.qtyLeft;
            exist.buy = prod.buy;
            exist.sell = prod.sell;
            exist.image = prod.image;
        } else stock.push(prod);

        localStorage.setItem("stock", JSON.stringify(stock));
        clearInputs();
        renderImages();
        alert("âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­");
    }

    if(imgFile) reader.readAsDataURL(imgFile);
    else reader.onload();
}

// ===== Ù…Ø³Ø­ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª =====
function clearInputs(){
    document.getElementById("product").value = "";
    document.getElementById("newCategory").value = "";
    document.getElementById("buy").value = "";
    document.getElementById("sell").value = "";
    document.getElementById("qty").value = "";
    document.getElementById("barcode").value = "";
    document.getElementById("date").value = "";
    document.getElementById("expiry").value = "";
    document.getElementById("imageInput").value = "";
}

// ===== Ø±Ø³Ù… Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† =====
function renderStockTable(){
    tbody.innerHTML="";
    stock.forEach((p,i)=>{
        let tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${p.name}</td>
            <td>${p.category}</td>
            <td>${p.qtyOriginal}</td>
            <td class="stockLabel">${p.qtyLeft}</td>
            <td>${p.sell}</td>
            <td>
                <button onclick="editItem(${i})">âœï¸</button>
                <button onclick="deleteItem(${i})">ğŸ—‘ï¸</button>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

// ===== ØªØ¹Ø¯ÙŠÙ„ Ù…Ù†ØªØ¬ =====
function editItem(i){
    const p = stock[i];
    let newName = prompt("Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬:", p.name) || p.name;
    let newCat = prompt("Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©:", p.category) || p.category;
    let newBuy = prompt("Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡:", p.buy) || p.buy;
    let newSell = prompt("Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹:", p.sell) || p.sell;
    let newQty = prompt("Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø£ØµÙ„ÙŠØ©:", p.qtyOriginal) || p.qtyOriginal;

    p.name = newName;
    p.category = newCat;
    p.buy = +newBuy;
    p.sell = +newSell;
    p.qtyOriginal = +newQty;
    p.qtyLeft = Math.min(p.qtyLeft, +newQty);

    if(!categories.includes(newCat)) categories.push(newCat);
    updateCategoryDropdown();

    localStorage.setItem("stock", JSON.stringify(stock));
    renderImages();
}

// ===== Ø­Ø°Ù Ù…Ù†ØªØ¬ =====
function deleteItem(i){
    if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ")){
        stock.splice(i,1);
        localStorage.setItem("stock", JSON.stringify(stock));
        renderImages();
    }
}

renderImages();
</script>

</body>
</html>
