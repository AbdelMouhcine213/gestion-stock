<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Stock / Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    font-family:Comic Sans MS;
    direction:rtl;
    background:#0b0b0b;
    color:white;
    margin:0;
}
header{
    background:#00ff99;
    color:black;
    padding:18px;
    text-align:center;
    font-size:30px;
    box-shadow:0 0 25px #00ff99;
}
.top{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:15px;
}
select{
    padding:8px;
    font-size:16px;
}
button{
    padding:8px 14px;
    font-size:16px;
    cursor:pointer;
    border:none;
    border-radius:6px;
}
.deleteAll{ background:#ff4444;color:white }

#searchStock{
    width:95%;
    margin:15px auto;
    padding:10px;
    font-size:16px;
    border-radius:6px;
    border:1px solid #ccc;
    display:block;
}

table{
    width:98%;
    margin:auto;
    border-collapse:collapse;
    background:#000;
    font-size:15px;
}
th,td{
    border:1px solid #00ff99;
    padding:8px;
    text-align:center;
}
th{ background:#00ff99; color:black; }
td[contenteditable]{ background:#111; }

.btnDel{
    background:#ff4444;
    color:white;
}
</style>
</head>

<body>

<header id="title">ğŸ“¦ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</header>

<div class="top">
    <button class="deleteAll" onclick="deleteSelected()">ğŸ—‘ Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø¯Ø¯</button>
    <select onchange="changeLang(this.value)">
        <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
        <option value="fr">FranÃ§ais</option>
        <option value="en">English</option>
    </select>
</div>

<!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ØªÙ‚Ø¯Ù… -->
<input type="text" id="searchStock" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ Ø£Ùˆ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø´Ø±Ø§Ø¡ (ÙŠÙˆÙ…/Ø´Ù‡Ø±/Ø³Ù†Ø©) Ø£Ùˆ Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹">

<table>
<thead>
<tr>
<th><input type="checkbox" onclick="selectAll(this)"></th>
<th id="hDate">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø´Ø±Ø§Ø¡</th>
<th id="hName">Ø§Ù„Ù…Ù†ØªØ¬</th>
<th id="hBuy">Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡</th>
<th id="hSell">Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹</th>
<th id="hQtyO">Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø£ØµÙ„ÙŠØ©</th>
<th id="hQtyL">Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©</th>
<th id="hTotalB">Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø´Ø±Ø§Ø¡</th>
<th id="hTotalS">Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø¨ÙŠØ¹</th>
<th id="hExp">Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</th>
<th id="hDel">Ø­Ø°Ù</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

<script>
let stock = JSON.parse(localStorage.getItem("stock")) || [];
const tbody = document.getElementById("tbody");

function render(filter=""){
    tbody.innerHTML="";
    const text = filter.toLowerCase();

    stock.forEach((p,i)=>{
        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ® Ù„ØµÙŠØºØ© ÙŠÙˆÙ…/Ø´Ù‡Ø±/Ø³Ù†Ø©
        let formattedDate = "";
        if(p.date){
            const d = new Date(p.date);
            const day = String(d.getDate()).padStart(2,'0');
            const month = String(d.getMonth()+1).padStart(2,'0');
            const year = d.getFullYear();
            formattedDate = `${day}/${month}/${year}`;
        }

        // ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø¨Ø­Ø«
        if(
            p.name.toLowerCase().includes(text) ||
            formattedDate.includes(text) ||
            p.sell.toString().includes(text)
        ){
            let tr = document.createElement("tr");
            tr.innerHTML=`
<td><input type="checkbox" class="chk" data-i="${i}"></td>
<td contenteditable onblur="upd(${i},'date',this.innerText)">${p.date||""}</td>
<td contenteditable onblur="upd(${i},'name',this.innerText)">${p.name}</td>
<td contenteditable onblur="upd(${i},'buy',this.innerText)">${p.buy}</td>
<td contenteditable onblur="upd(${i},'sell',this.innerText)">${p.sell}</td>
<td contenteditable onblur="upd(${i},'qtyOriginal',this.innerText)">${p.qtyOriginal||0}</td>
<td contenteditable onblur="upd(${i},'qtyLeft',this.innerText)">${p.qtyLeft||0}</td>
<td>${(p.qtyOriginal||0)*(p.buy||0)}</td>
<td>${(p.qtyLeft||0)*(p.sell||0)}</td>
<td contenteditable onblur="upd(${i},'expiry',this.innerText)">${p.expiry||""}</td>
<td><button class="btnDel" onclick="del(${i})">âŒ</button></td>
            `;
            tbody.appendChild(tr);
        }
    });
}

function upd(i,k,v){
    // Ù‚Ø¨ÙˆÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¨ØµÙŠØºØ© Ù†ØµÙŠØ© Ø£Ùˆ Ø±Ù‚Ù…ÙŠØ©
    stock[i][k]=isNaN(v)?v:Number(v);
    localStorage.setItem("stock",JSON.stringify(stock));
    render(document.getElementById("searchStock").value);
}

function del(i){
    if(confirm("Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ØŸ")){
        stock.splice(i,1);
        localStorage.setItem("stock",JSON.stringify(stock));
        render(document.getElementById("searchStock").value);
    }
}

function selectAll(cb){
    document.querySelectorAll(".chk").forEach(c=>c.checked=cb.checked);
}

function deleteSelected(){
    let ids=[...document.querySelectorAll(".chk")]
        .filter(c=>c.checked)
        .map(c=>Number(c.dataset.i))
        .sort((a,b)=>b-a);

    if(!ids.length){ alert("Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø´ÙŠØ¡"); return; }

    if(confirm("Ø­Ø°Ù Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©ØŸ")){
        ids.forEach(i=>stock.splice(i,1));
        localStorage.setItem("stock",JSON.stringify(stock));
        render(document.getElementById("searchStock").value);
    }
}

// Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø«
document.getElementById("searchStock").addEventListener("input", function(){
    render(this.value);
});

// Ø§Ù„Ù„ØºØ§Øª
function changeLang(l){
    const t={
        ar:["ğŸ“¦ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†","ØªØ§Ø±ÙŠØ® Ø§Ù„Ø´Ø±Ø§Ø¡","Ø§Ù„Ù…Ù†ØªØ¬","Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡","Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹","Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø£ØµÙ„ÙŠØ©","Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©","Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø´Ø±Ø§Ø¡","Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø¨ÙŠØ¹","Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©","Ø­Ø°Ù"],
        fr:["ğŸ“¦ Stock","Date achat","Produit","Prix achat","Prix vente","QtÃ© initiale","QtÃ© restante","Total achat","Total vente","Expiration","Supprimer"],
        en:["ğŸ“¦ Stock","Purchase date","Product","Buy price","Sell price","Original qty","Remaining qty","Buy total","Sell total","Expiry","Delete"]
    }[l];

    document.getElementById("title").innerText=t[0];
    ["hDate","hName","hBuy","hSell","hQtyO","hQtyL","hTotalB","hTotalS","hExp","hDel"]
    .forEach((id,i)=>document.getElementById(id).innerText=t[i+1]);
}

render();
</script>

</body>
</html>