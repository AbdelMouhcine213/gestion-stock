<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø´Ø§Ø´Ø© Ø§Ù„Ø¨ÙŠØ¹</title>

<style>
body{
    margin:0;
    font-family:Tahoma;
    direction:rtl;
    background:#f1f5f9;
}
header{
    background:#1e293b;
    color:#fff;
    padding:15px;
    font-size:20px;
}
.container{
    display:flex;
}
.products{
    width:65%;
    padding:15px;
}
.cart{
    width:35%;
    background:#fff;
    padding:15px;
    border-right:3px solid #e5e7eb;
}
.search{
    width:100%;
    padding:10px;
    margin-bottom:15px;
    font-size:16px;
}
.category{
    margin-bottom:25px;
}
.category h3{
    background:#0ea5e9;
    color:#fff;
    padding:8px;
    border-radius:6px;
}
.items{
    display:flex;
    flex-wrap:wrap;
    gap:10px;
}
.item{
    width:120px;
    background:#fff;
    border:1px solid #ddd;
    border-radius:6px;
    text-align:center;
    padding:8px;
    cursor:pointer;
}
.item img{
    width:100%;
    height:80px;
    object-fit:cover;
}
.stock{
    font-size:12px;
    color:#ef4444;
}
.cart input{
    width:100%;
    padding:8px;
    margin-bottom:10px;
}
table{
    width:100%;
    border-collapse:collapse;
}
th,td{
    border-bottom:1px solid #ddd;
    padding:6px;
    text-align:center;
}
.total{
    margin-top:10px;
    font-size:18px;
    font-weight:bold;
}
</style>
</head>

<body>

<header>ğŸ§¾ Ø´Ø§Ø´Ø© Ø§Ù„Ø¨ÙŠØ¹</header>

<div class="container">

<div class="products">
<input class="search" placeholder="ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬" onkeyup="searchProducts(this.value)">
<div id="products"></div>
</div>

<div class="cart">
<input id="cartName" value="Ø³Ù„Ø© Ø¨ÙŠØ¹">
<table>
<thead>
<tr>
<th>Ù…Ù†ØªØ¬</th>
<th>ÙƒÙ…ÙŠØ©</th>
<th>Ø³Ø¹Ø±</th>
<th>âŒ</th>
</tr>
</thead>
<tbody id="cartItems"></tbody>
</table>
<div class="total">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: <span id="total">0</span> Ø¯Ø¬</div>
</div>

</div>

<script>
let products = JSON.parse(localStorage.getItem("products")) || [];
let cart = [];

// ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¥Ù„Ù‰ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª
function groupByCategory(list){
    let grouped = {};
    list.forEach(p=>{
        if(!grouped[p.category]) grouped[p.category]=[];
        grouped[p.category].push(p);
    });
    return grouped;
}

// Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
function renderProducts(list = products){
    let grouped = groupByCategory(list);
    let html = "";
    for(let cat in grouped){
        html += `<div class="category">
        <h3>${cat}</h3>
        <div class="items">`;
        grouped[cat].forEach((p,i)=>{
            html += `
            <div class="item" onclick="addToCart(${i})">
                <img src="${p.image}">
                <div>${p.name}</div>
                <div>${p.price} Ø¯Ø¬</div>
                <div class="stock">Ù…ØªØ¨Ù‚ÙŠ: ${p.quantity}</div>
            </div>`;
        });
        html += `</div></div>`;
    }
    document.getElementById("products").innerHTML = html;
}
renderProducts();

// Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©
function addToCart(index){
    let p = products[index];
    if(p.quantity <= 0){
        alert("Ø§Ù„ÙƒÙ…ÙŠØ© ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©");
        return;
    }
    let item = cart.find(i => i.name === p.name);
    if(item){
        item.qty++;
    }else{
        cart.push({name:p.name, price:p.price, qty:1});
    }
    p.quantity--;
    save();
    renderCart();
    renderProducts();
}

// Ø§Ù„Ø³Ù„Ø©
function renderCart(){
    let html = "";
    let total = 0;
    cart.forEach((i,idx)=>{
        total += i.price * i.qty;
        html += `
        <tr>
            <td>${i.name}</td>
            <td>
                <input type="number" value="${i.qty}" min="1"
                onchange="changeQty(${idx},this.value)">
            </td>
            <td>${i.price * i.qty}</td>
            <td><button onclick="removeItem(${idx})">âŒ</button></td>
        </tr>`;
    });
    document.getElementById("cartItems").innerHTML = html;
    document.getElementById("total").innerText = total;
}

function changeQty(i,val){
    let diff = val - cart[i].qty;
    let p = products.find(x => x.name === cart[i].name);
    if(p.quantity - diff < 0){
        alert("ÙƒÙ…ÙŠØ© ØºÙŠØ± ÙƒØ§ÙÙŠØ©");
        return;
    }
    p.quantity -= diff;
    cart[i].qty = parseInt(val);
    save();
    renderCart();
    renderProducts();
}

function removeItem(i){
    let p = products.find(x => x.name === cart[i].name);
    p.quantity += cart[i].qty;
    cart.splice(i,1);
    save();
    renderCart();
    renderProducts();
}

// Ø§Ù„Ø¨Ø­Ø«
function searchProducts(txt){
    let filtered = products.filter(p =>
        p.name.toLowerCase().includes(txt.toLowerCase())
    );
    renderProducts(filtered);
}

function save(){
    localStorage.setItem("products", JSON.stringify(products));
}
</script>

</body>
</html>
