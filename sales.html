<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>POS</title>
<style>
*{box-sizing:border-box}
body{margin:0;font-family:Arial;direction:rtl;background:linear-gradient(160deg,#050b18,#0b2a52);color:white;}
header{display:flex;justify-content:space-between;align-items:center;padding:15px;background:linear-gradient(90deg,#198754,#20c997);font-size:26px;font-weight:bold;}
select{padding:6px;border-radius:8px;border:none;font-size:16px;}
#categories{display:flex;gap:10px;padding:10px;overflow-x:auto;}
.cat{background:#0dcaf0;color:black;padding:10px 18px;border-radius:20px;font-weight:bold;cursor:pointer;white-space:nowrap;}
.cat.active{background:#00ff88}
#searchGroup{margin:10px 12px;padding:6px;width:calc(100% - 24px);border-radius:10px;border:none;font-size:16px;}
#suggestions{background:#fff;color:#000;position:absolute;z-index:1000;width:calc(100% - 24px);border-radius:10px;max-height:180px;overflow-y:auto;display:none;}
#products{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:12px;padding:12px;}
.product{background:white;color:black;border-radius:16px;padding:8px;text-align:center;cursor:pointer;box-shadow:0 0 15px rgba(0,0,0,.3);position:relative;}
.product img{width:100%;height:120px;object-fit:contain;}
.product span, .product b{display:block;}
.stockLabel{position:absolute;top:8px;right:8px;background:rgba(0,0,0,0.7);color:#00ff88;padding:2px 6px;border-radius:6px;font-size:14px;font-weight:bold;}
#cartBox{background:#081a33;margin:10px;border-radius:16px;padding:10px;box-shadow:0 0 15px rgba(0,255,150,.4);}
#cartTitle{display:flex;justify-content:space-between;align-items:center;}
#cartTitle input{font-size:18px;font-weight:bold;border-radius:8px;border:none;padding:6px;}
table{width:100%;border-collapse:collapse;margin-top:8px;}
th,td{border-bottom:1px solid #444;padding:6px;text-align:center;}
th{background:#0dcaf0;color:black}
button{padding:6px 10px;border:none;border-radius:6px;cursor:pointer;}
.del{background:#dc3545;color:white}
#totalBox{margin-top:10px;background:black;border-radius:16px;padding:15px;text-align:center;box-shadow:0 0 30px rgba(0,255,0,.7);}
#totalBox span{font-size:20px;}
#total{font-size:42px;color:#00ff88;font-weight:bold;}
.btn.confirm{margin-top:10px;padding:10px 20px;font-size:18px;background:linear-gradient(45deg,#28a745,#20c997);color:white;border-radius:12px;cursor:pointer;border:none;}
.suggestionItem{padding:5px 8px;cursor:pointer;}
.suggestionItem:hover{background:#eee;color:black;}

/* ====== Modal ====== */
#modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);z-index:10000;justify-content:center;align-items:center;}
#modalContent{background:#081a33;padding:20px;border-radius:16px;width:90%;max-width:800px;max-height:90%;overflow-y:auto;position:relative;}
.modalHeader{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;}
.modalHeader h2{margin:0;color:#0ff;}
.modalClose{background:#dc3545;color:white;padding:6px 12px;border:none;border-radius:8px;cursor:pointer;}
.modalProducts{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:12px;}
.modalProduct{background:white;color:black;border-radius:12px;padding:8px;text-align:center;cursor:pointer;position:relative;}
.modalProduct img{width:100%;height:100px;object-fit:contain;}
.modalProduct input{width:60px;margin-top:4px;border-radius:6px;border:1px solid #ccc;text-align:center;}
.modalStock{position:absolute;top:4px;right:4px;background:rgba(0,0,0,0.7);color:#0f0;padding:2px 4px;border-radius:6px;font-size:12px;}
.confirmModalBtn{margin-top:10px;padding:10px 20px;font-size:16px;background:linear-gradient(45deg,#28a745,#20c997);color:white;border:none;border-radius:10px;cursor:pointer;}
</style>
</head>
<body>

<header>
    <span id="title">ðŸ’³ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</span>
    <select id="lang" onchange="setLang(this.value)">
        <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
        <option value="fr">FranÃ§ais</option>
        <option value="en">English</option>
    </select>
</header>

<!-- Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°ÙƒÙŠ -->
<input id="searchGroup" placeholder="ðŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£ÙŠ Ù…Ù†ØªØ¬..." onkeyup="showSuggestions(this.value)">
<div id="suggestions"></div>

<div id="categories"></div>
<div id="products"></div>

<div id="cartBox">
    <div id="cartTitle">
        <span>ðŸ›’ Ø³Ù„Ø© Ø§Ù„Ø´Ø±Ø§Ø¡</span>
        <span id="itemsLabel">Ø§Ù„Ø¹Ù†Ø§ØµØ±</span>
    </div>

    <table>
        <thead>
            <tr>
                <th id="p">Ø§Ù„Ù…Ù†ØªØ¬</th>
                <th id="q">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                <th id="pr">Ø§Ù„Ø³Ø¹Ø±</th>
                <th id="t">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
                <th>âœ–</th>
            </tr>
        </thead>
        <tbody id="cart"></tbody>
    </table>

    <div id="totalBox">
        <span id="totalLabel">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ</span>
        <div id="total">0</div>
    </div>
    <button onclick="confirmSale()" class="btn confirm">âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨ÙŠØ¹</button>
</div>

<!-- Modal Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª -->
<div id="modal">
    <div id="modalContent">
        <div class="modalHeader">
            <h2 id="modalTitle"></h2>
            <button class="modalClose" onclick="closeModal()">âœ– Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
        <div class="modalProducts" id="modalProducts"></div>
        <button class="confirmModalBtn" onclick="confirmModalSelection()">âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±</button>
    </div>
</div>

<script>
// ===== Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙˆØ§Ù„Ø³Ù„Ù‘Ø© =====
let stock = JSON.parse(localStorage.getItem("products")) || [];
let cart = [];
let currentCat = null;
let modalSelection = [];

// ===== Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª =====
let categoriesList = ["Ø§Ù„Ø­Ù„ÙˆÙŠØ§Øª","Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª","Ø§Ù„Ø¹Ø·ÙˆØ± Ø§Ù„Ø±Ø¬Ø§Ù„ÙŠØ©","Ø§Ù„Ù…ÙƒØ³Ø±Ø§Øª","Ø§Ù„Ø¹Ø·ÙˆØ± Ø§Ù„Ù†Ø³Ø§Ø¦ÙŠØ©","CosmÃ©tique","Ø§Ù„ØªØ¯Ø®ÙŠÙ†"];

// ===== Ù„ØºØ§Øª =====
const words={
ar:{title:"ðŸ’³ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª",items:"Ø§Ù„Ø¹Ù†Ø§ØµØ±",p:"Ø§Ù„Ù…Ù†ØªØ¬",q:"Ø§Ù„ÙƒÙ…ÙŠØ©",pr:"Ø§Ù„Ø³Ø¹Ø±",t:"Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹",tot:"Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ"}
};

// ======== Ø§Ù„Ù„ØºØ§Øª ========
function setLang(l){
    document.body.dir = l==="ar"?"rtl":"ltr";
    document.getElementById("title").textContent=words[l].title;
    itemsLabel.textContent=words[l].items;
    p.textContent=words[l].p;
    q.textContent=words[l].q;
    pr.textContent=words[l].pr;
    t.textContent=words[l].t;
    totalLabel.textContent=words[l].tot;
}

// ===== Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª
function renderCategories(){
    const catsDiv = document.getElementById("categories");
    catsDiv.innerHTML = "";
    categoriesList.forEach(c=>{
        let d=document.createElement("div");
        d.className="cat";
        d.textContent=c;
        d.onclick=()=>{ 
            currentCat=c;
            openModal(c);
        };
        catsDiv.appendChild(d);
    });
}

// ===== Modal Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
function openModal(cat){
    modalSelection = [];
    document.getElementById("modalTitle").textContent = cat;
    const modalProductsDiv = document.getElementById("modalProducts");
    modalProductsDiv.innerHTML = "";
    stock.filter(p=>p.category===cat && p.qtyLeft>0).forEach((p,i)=>{
        let div = document.createElement("div");
        div.className="modalProduct";
        div.innerHTML=`
            <img src="${p.image}">
            <span>${p.name}</span>
            <b>${p.sell} Ø¯Ø¬</b>
            <div class="modalStock">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${p.qtyLeft}</div>
            <input type="number" min="1" max="${p.qtyLeft}" value="1" onchange="updateModalQty(${i},this.value)">
        `;
        div.onclick=()=>toggleSelection(p,i);
        modalProductsDiv.appendChild(div);
    });
    document.getElementById("modal").style.display="flex";
}

// ===== Toggle Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†ØªØ¬ ÙÙŠ Modal
function toggleSelection(p,i){
    let index = modalSelection.findIndex(x=>x.name===p.name);
    if(index>=0) modalSelection.splice(index,1);
    else modalSelection.push({...p,selectedQty:1});
}

// ===== ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙ…ÙŠØ© ÙÙŠ Modal
function updateModalQty(i,val){
    let p = stock.filter(x=>x.category===currentCat && x.qtyLeft>0)[i];
    let index = modalSelection.findIndex(x=>x.name===p.name);
    if(index>=0) modalSelection[index].selectedQty = Math.min(val,p.qtyLeft);
}

// ===== ØªØ£ÙƒÙŠØ¯ Ø§Ø®ØªÙŠØ§Ø± Modal
function confirmModalSelection(){
    modalSelection.forEach(p=>{
        let f = cart.find(i=>i.name===p.name);
        if(f){
            f.qty = Math.min(f.qty + p.selectedQty, p.qtyLeft);
        } else cart.push({name:p.name,price:p.sell,qty:p.selectedQty,qtyLeft:p.qtyLeft,category:p.category,image:p.image});
    });
    closeModal();
    renderCart();
}

// ===== Ø¥ØºÙ„Ø§Ù‚ Modal
function closeModal(){ document.getElementById("modal").style.display="none"; }

// ===== Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°ÙƒÙŠ
function showSuggestions(text){
    const sugDiv = document.getElementById("suggestions");
    if(text.trim()===""){ sugDiv.style.display="none"; return; }
    const t = text.toLowerCase();
    const filtered = stock.filter(p=>p.name.toLowerCase().startsWith(t) && p.qtyLeft>0);
    sugDiv.innerHTML="";
    filtered.forEach(p=>{
        let d=document.createElement("div");
        d.className="suggestionItem";
        d.textContent=p.name;
        d.onclick=()=>{
            addToCart(p);
            sugDiv.style.display="none";
        };
        sugDiv.appendChild(d);
    });
    sugDiv.style.display = filtered.length>0 && filtered.length>0 ? "block" : "none";
}

// ===== Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©
function addToCart(p){
    let f = cart.find(i=>i.name===p.name);
    if(f){ f.qty = Math.min(f.qty+1,p.qtyLeft); }
    else cart.push({name:p.name,price:p.sell,qty:1,qtyLeft:p.qtyLeft,category:p.category,image:p.image});
    renderCart();
}

// ===== Ø±Ø³Ù… Ø§Ù„Ø³Ù„Ø©
function renderCart(){
    const tbody = document.getElementById("cart");
    tbody.innerHTML="";
    let sum=0;
    cart.forEach((i,n)=>{
        let tot = i.qty*i.price;
        sum+=tot;
        let tr = document.createElement("tr");
        tr.innerHTML=`
            <td>${i.name}</td>
            <td><input type="number" value="${i.qty}" min="1" max="${i.qtyLeft}" onchange="changeQty(${n},this.value)"></td>
            <td><input type="number" value="${i.price}" min="0" onchange="changePrice(${n},this.value)"></td>
            <td>${tot}</td>
            <td><button class="del" onclick="removeItem(${n})">âœ–</button></td>
        `;
        tbody.appendChild(tr);
    });
    document.getElementById("total").textContent=sum+" Ø¯Ø¬";
}

function changeQty(idx,val){ cart[idx].qty=Math.min(val,cart[idx].qtyLeft); renderCart(); }
function changePrice(idx,val){ cart[idx].price=Math.max(0,val); renderCart(); }
function removeItem(idx){ cart.splice(idx,1); renderCart(); }

// ===== ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨ÙŠØ¹ Ù…Ø¹ Ø±Ø¨Ø· Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª
function confirmSale(){
    if(cart.length===0){ alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ± ÙÙŠ Ø§Ù„Ø³Ù„Ø©"); return; }
    cart.forEach(c=>{
        let s = stock.find(x=>x.name===c.name);
        if(s) s.qtyLeft -= c.qty;
        else stock.push({name:c.name,sell:c.price,qtyLeft:0,category:c.category,image:c.image});
    });
    localStorage.setItem("products",JSON.stringify(stock));
    alert("âœ… ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨ÙŠØ¹ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ†");
    cart=[];
    renderCart();
}

renderCategories();
setLang("ar");
</script>

</body>
</html>
