<!DOCTYPE html>
<html lang="ar">
<head>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#28a745">
<meta charset="UTF-8">
<title>Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</title>

<style>
body{
    margin:0;
    font-family:Arial;
    direction:rtl;
    background:#f4f6f8;
}

/* Ø§Ù„Ø¹Ù†ÙˆØ§Ù† */
header{
    background:#0d6efd;
    color:white;
    padding:20px;
    text-align:center;
    font-size:32px;
    font-weight:bold;
}

/* Ø§Ù„ØªØ®Ø·ÙŠØ· */
.container{
    display:flex;
    gap:30px;
    padding:25px;
}

/* ğŸ”¢ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ */
.total-box{
    width:320px;
    height:200px;
    background:#28a745;
    color:white;
    font-size:52px;
    font-weight:bold;
    border-radius:20px;
    display:flex;
    align-items:center;
    justify-content:center;
    box-shadow:0 0 15px rgba(0,0,0,.3);
}

/* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¹Ù…Ù„ */
.work{
    flex:1;
}

/* Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„Ø§Øª */
.inputs{
    display:flex;
    gap:15px;
    margin-bottom:20px;
}

.inputs input{
    padding:18px;
    font-size:22px;
    border-radius:10px;
    border:1px solid #bbb;
    width:230px;
}

.inputs input[readonly]{
    background:#eee;
}

/* Ø§Ù„Ø¨Ø­Ø« */
.search{
    position:relative;
}

.suggestions{
    position:absolute;
    background:white;
    width:230px;
    border:1px solid #ccc;
    border-radius:10px;
    z-index:1000;
}

.suggestions div{
    padding:14px;
    font-size:20px;
    cursor:pointer;
}

.suggestions div:hover{
    background:#f1f1f1;
}

/* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
.btn{
    padding:18px 26px;
    font-size:22px;
    border:none;
    border-radius:10px;
    cursor:pointer;
    color:white;
}

.add{ background:#17a2b8; }
.save{ background:#28a745; }
.delete{ background:#dc3545; }

/* Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
table{
    width:100%;
    background:white;
    border-collapse:collapse;
    font-size:20px;
}

th, td{
    padding:14px;
    border:1px solid #ddd;
    text-align:center;
}

th{
    background:#0d6efd;
    color:white;
}
</style>
</head>

<body>

<header>ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</header>

<div class="container">

<!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¹Ù…Ù„ -->
<div class="work">

    <!-- Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ -->
    <div class="inputs">

        <div class="search">
            <input type="text" id="productSearch"
                   placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬"
                   autocomplete="off">
            <div id="suggestions" class="suggestions"></div>
        </div>

        <input type="number" id="price" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹" readonly>
        <input type="number" id="qty" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">

        <button class="btn add" onclick="addSale()">Ø¥Ø¶Ø§ÙØ©</button>
    </div>

    <!-- Ø§Ù„Ø¬Ø¯ÙˆÙ„ -->
    <table>
        <thead>
        <tr>
            <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
            <th>Ø§Ù„Ø³Ø¹Ø±</th>
            <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
            <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
            <th>Ø­Ø°Ù</th>
        </tr>
        </thead>
        <tbody id="tbody"></tbody>
    </table>

    <br>
    <button class="btn save" onclick="saveSale()">Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ¹</button>
</div>

<!-- Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ -->
<div class="total-box" id="total">0</div>

</div>

<script>
/* ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª */
let stock = JSON.parse(localStorage.getItem("stock")) || [];
let sales = [];
const tbody = document.getElementById("tbody");

/* ğŸ” Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ† */
const productInput = document.getElementById("productSearch");
const suggestions = document.getElementById("suggestions");
const priceInput = document.getElementById("price");

productInput.addEventListener("input", function(){
    let value = this.value.trim().toLowerCase();
    suggestions.innerHTML = "";
    if(!value) return;

    stock.forEach(p=>{
        if(p.name.toLowerCase().startsWith(value) && p.qtyLeft > 0){
            let div = document.createElement("div");
            div.textContent = p.name + " (Ù…ØªØ¨Ù‚ÙŠ: " + p.qtyLeft + ")";
            div.onclick = ()=>{
                productInput.value = p.name;
                priceInput.value = p.sell;
                suggestions.innerHTML="";
            };
            suggestions.appendChild(div);
        }
    });
});

/* â• Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø¨ÙŠØ¹ */
function addSale(){
    let name = productInput.value;
    let q = Number(qty.value);
    let product = stock.find(p=>p.name===name);

    if(!product || q<=0){
        alert("Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
        return;
    }
    if(q > product.qtyLeft){
        alert("Ø§Ù„ÙƒÙ…ÙŠØ© ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©");
        return;
    }

    let existing = sales.find(s=>s.name===name);
    if(existing){
        existing.qty += q;
    }else{
        sales.push({name, price:product.sell, qty:q});
    }

    render();
    productInput.value="";
    priceInput.value="";
    qty.value="";
}

/* ğŸ–Šï¸ Ø¹Ø±Ø¶ + ØªØ¹Ø¯ÙŠÙ„ */
function render(){
    tbody.innerHTML="";
    let total=0;

    sales.forEach((s,i)=>{
        let sum = s.price * s.qty;
        total += sum;

        let tr=document.createElement("tr");
        tr.innerHTML=`
<td>${s.name}</td>
<td>
<input type="number" value="${s.price}"
onchange="updatePrice(${i},this.value)">
</td>
<td>
<input type="number" value="${s.qty}"
onchange="updateQty(${i},this.value)">
</td>
<td>${sum}</td>
<td><button class="btn delete" onclick="del(${i})">âŒ</button></td>
        `;
        tbody.appendChild(tr);
    });

    document.getElementById("total").textContent = total;
}

function updatePrice(i,v){
    sales[i].price = Number(v);
    render();
}

function updateQty(i,v){
    let product = stock.find(p=>p.name===sales[i].name);
    v = Number(v);

    if(v<=0 || v>product.qtyLeft){
        alert("ÙƒÙ…ÙŠØ© ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
        render();
        return;
    }
    sales[i].qty = v;
    render();
}

function del(i){
    sales.splice(i,1);
    render();
}

/* ğŸ’¾ Ø§Ù„Ø­ÙØ¸ + Ø§Ù„Ø±Ø¨Ø· Ø¨Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
function saveSale(){
    if(!sales.length){
        alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨ÙŠØ¹Ø§Øª");
        return;
    }

    /* Ø®ØµÙ… Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ† */
    sales.forEach(s=>{
        let p = stock.find(x=>x.name===s.name);
        if(p) p.qtyLeft -= s.qty;
    });
    localStorage.setItem("stock", JSON.stringify(stock));

    /* ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
    let history = JSON.parse(localStorage.getItem("salesHistory")) || [];
    sales.forEach(s=>{
        history.push({
            name:s.name,
            price:s.price,
            qty:s.qty,
            date:new Date().toISOString().split("T")[0]
        });
    });
    localStorage.setItem("salesHistory", JSON.stringify(history));

    alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ¹ Ø¨Ù†Ø¬Ø§Ø­ âœ…");
    sales=[];
    render();
}
</script>

</body>
</html>
