<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Arial;direction:rtl;background:#08152a;color:white;padding:15px}
.card{background:#0b1f3f;padding:15px;border-radius:12px;margin-bottom:10px}
button,input{padding:10px;border-radius:8px;border:none}
button{background:#28a745;color:white}
</style>
</head>
<body>

<h2>ðŸ›’ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h2>
<div id="products"></div>

<script type="module">
import { db } from "./firebase.js";
import { ref, onValue, update, push, set, get }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const list=document.getElementById("products");

onValue(ref(db,"stock"),snap=>{
 list.innerHTML="";
 const data=snap.val()||{};
 Object.entries(data).forEach(([id,p])=>{
  let d=document.createElement("div");
  d.className="card";
  d.innerHTML=`
   <b>${p.name}</b><br>
   Ù…ØªØ¨Ù‚ÙŠ: ${p.qtyLeft}<br>
   <input type="number" id="q${id}" value="1">
   <button onclick="sell('${id}')">Ø¨ÙŠØ¹</button>`;
  list.appendChild(d);
 });
});

window.sell=async(id)=>{
 let q=+document.getElementById("q"+id).value;
 let r=ref(db,"stock/"+id);
 let s=await get(r);
 let p=s.val();
 if(p.qtyLeft<q) return alert("ÙƒÙ…ÙŠØ© ØºÙŠØ± ÙƒØ§ÙÙŠØ©");
 await update(r,{qtyLeft:p.qtyLeft-q});
 await set(push(ref(db,"sales")),{
  name:p.name,
  buy:p.buy,
  sell:p.sell,
  qty:q,
  date:new Date().toISOString().split("T")[0]
 });
 alert("ØªÙ… Ø§Ù„Ø¨ÙŠØ¹");
};
</script>
</body>
</html>
