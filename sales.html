<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>POS</title>

<style>
*{box-sizing:border-box}
body{margin:0;font-family:Arial;direction:rtl;background:linear-gradient(160deg,#050b18,#0b2a52);color:white;}
header{display:flex;justify-content:space-between;align-items:center;padding:15px;background:linear-gradient(90deg,#198754,#20c997);font-size:26px;font-weight:bold;}
#categories{display:flex;gap:10px;padding:10px;overflow-x:auto;}
.cat{background:#0dcaf0;color:black;padding:10px 18px;border-radius:20px;font-weight:bold;cursor:pointer;white-space:nowrap;}
.cat.active{background:#00ff88}
#products{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:12px;padding:12px;}
.product{background:white;color:black;border-radius:16px;padding:8px;text-align:center;cursor:pointer;box-shadow:0 0 15px rgba(0,0,0,.3);position:relative;}
.product img{width:100%;height:120px;object-fit:contain;}
.stockLabel{position:absolute;top:8px;right:8px;background:rgba(0,0,0,0.7);color:#00ff88;padding:2px 6px;border-radius:6px;font-size:14px;font-weight:bold;}
</style>
</head>

<body>

<header>ğŸ’³ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</header>

<div id="categories"></div>
<div id="products"></div>

<script>
const SHEET_URL = "https://script.google.com/macros/s/YOUR_WEB_APP_ID/exec";

let stock = [];

/* ===== ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ===== */
async function loadStock(){
    try{
        const res = await fetch(SHEET_URL+"?action=getStock");
        stock = await res.json();
        if(!Array.isArray(stock)) throw "no data";
    }catch{
        // fallback Ù…Ù† localStorage
        stock = JSON.parse(localStorage.getItem("products")) || [];
    }

    if(stock.length === 0){
        document.getElementById("products").innerHTML =
        "<h3>âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…Ø³Ø¬Ù„Ø©</h3>";
        return;
    }

    renderCategories();
}

/* ===== Ø±Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª ===== */
function renderCategories(){
    const cats = [...new Set(stock.map(p=>p.category))];
    categories.innerHTML = "";

    cats.forEach((c,i)=>{
        const d = document.createElement("div");
        d.className = "cat";
        d.textContent = c;
        d.onclick = ()=>{
            document.querySelectorAll(".cat").forEach(x=>x.classList.remove("active"));
            d.classList.add("active");
            showProducts(c);
        };
        categories.appendChild(d);

        if(i===0) d.click(); // Ø£ÙˆÙ„ Ù…Ø¬Ù…ÙˆØ¹Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
    });
}

/* ===== Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ===== */
function showProducts(cat){
    products.innerHTML = "";
    stock
    .filter(p=>p.category===cat && p.quantity>0)
    .forEach(p=>{
        const d = document.createElement("div");
        d.className="product";
        d.innerHTML=`
            <img src="${p.image || 'https://via.placeholder.com/150'}">
            <b>${p.name}</b>
            <span>${p.price} Ø¯Ø¬</span>
            <div class="stockLabel">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${p.quantity}</div>
        `;
        products.appendChild(d);
    });
}

loadStock();
</script>

</body>
</html>
