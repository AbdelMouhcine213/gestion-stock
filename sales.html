<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>POS - Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</title>
<style>
*{box-sizing:border-box;}
body{margin:0;font-family:Arial;direction:rtl;background:linear-gradient(160deg,#050b18,#0b2a52);color:white;}
header{display:flex;justify-content:space-between;align-items:center;padding:15px;background:linear-gradient(90deg,#198754,#20c997);font-size:26px;font-weight:bold;}
select,input{padding:6px;border-radius:8px;border:none;font-size:16px;}
#searchBox{width:250px;padding:8px;border-radius:10px;border:1px solid #0ff;background:#000;color:#0ff;}
#categories{display:flex;gap:10px;padding:10px;overflow-x:auto;margin-top:10px;}
.cat{background:#0dcaf0;color:black;padding:10px 18px;border-radius:20px;font-weight:bold;cursor:pointer;white-space:nowrap;}
.cat:hover{background:#66e3ff}
#products{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:12px;padding:12px;margin-top:10px;}
.product{background:white;color:black;border-radius:16px;padding:8px;text-align:center;cursor:pointer;box-shadow:0 0 15px rgba(0,0,0,.3);position:relative;}
.product img{width:100%;height:100px;object-fit:contain;}
.product span,.product b{display:block;}
.stockLabel{position:absolute;top:8px;right:8px;background:rgba(0,0,0,0.7);color:#00ff88;padding:2px 6px;border-radius:6px;font-size:14px;font-weight:bold;}
#cartBox{background:#081a33;margin:10px;border-radius:16px;padding:10px;box-shadow:0 0 15px rgba(0,255,150,.4);}
#cartTitle{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;}
table{width:100%;border-collapse:collapse;}
th,td{border-bottom:1px solid #444;padding:6px;text-align:center;}
th{background:#0dcaf0;color:black}
button{padding:6px 10px;border:none;border-radius:6px;cursor:pointer;}
.del{background:#dc3545;color:white}
#totalBox{margin-top:10px;background:black;border-radius:16px;padding:15px;text-align:center;box-shadow:0 0 30px rgba(0,255,0,.7);}
#totalBox span{font-size:20px;}
#total{font-size:42px;color:#00ff88;font-weight:bold;}
#statsBox{margin:10px;padding:10px;background:#111;border-radius:16px;}
#statsBox h3{margin:5px 0;color:#0ff;}
.btn.confirm{margin-top:10px;padding:10px 20px;font-size:18px;background:linear-gradient(45deg,#28a745,#20c997);color:white;border-radius:12px;cursor:pointer;border:none;}
</style>
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>

<header>
    <span id="title">ğŸ’³ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</span>
    <div>
        <input id="searchBox" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬">
        <select id="lang" onchange="setLang(this.value)">
            <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
            <option value="fr">FranÃ§ais</option>
            <option value="en">English</option>
        </select>
    </div>
</header>

<div id="categories"></div>
<div id="products"></div>

<div id="cartBox">
    <div id="cartTitle">
        <span>ğŸ›’ Ø³Ù„Ø© Ø§Ù„Ø´Ø±Ø§Ø¡</span>
        <span id="itemsLabel">Ø§Ù„Ø¹Ù†Ø§ØµØ±</span>
    </div>

    <table>
        <thead>
            <tr>
                <th id="p">Ø§Ù„Ù…Ù†ØªØ¬</th>
                <th id="q">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                <th id="pr">Ø§Ù„Ø³Ø¹Ø±</th>
                <th id="t">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
                <th>âœ–</th>
            </tr>
        </thead>
        <tbody id="cart"></tbody>
    </table>

    <div id="totalBox">
        <span id="totalLabel">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ</span>
        <div id="total">0</div>
    </div>
    <button onclick="confirmSale()" class="btn confirm">âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨ÙŠØ¹</button>
</div>

<div id="statsBox">
<h3>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…</h3>
<p id="dailyProfit">Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ØµØ§ÙÙŠ: 0 Ø¯Ø¬ | Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø®Ø§Ù…: 0 Ø¯Ø¬</p>
<h3>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</h3>
<p id="weeklyProfit">Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ØµØ§ÙÙŠ: 0 Ø¯Ø¬ | Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø®Ø§Ù…: 0 Ø¯Ø¬</p>
<h3>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø´Ù‡Ø±</h3>
<p id="monthlyProfit">Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ØµØ§ÙÙŠ: 0 Ø¯Ø¬ | Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø®Ø§Ù…: 0 Ø¯Ø¬</p>
</div>

<script>
// ===== Firebase Config =====
const firebaseConfig = {
    apiKey: "API_KEY_HERE",
    authDomain: "PROJECT_ID.firebaseapp.com",
    databaseURL: "https://PROJECT_ID.firebaseio.com",
    projectId: "PROJECT_ID",
    storageBucket: "PROJECT_ID.appspot.com",
    messagingSenderId: "SENDER_ID",
    appId: "APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ===== Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª =====
let stock = [];
let salesHistory = [];
let cart = [];
let currentCat = null;

// ===== Ù„ØºØ§Øª =====
const words = {
ar:{title:"ğŸ’³ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª",items:"Ø§Ù„Ø¹Ù†Ø§ØµØ±",p:"Ø§Ù„Ù…Ù†ØªØ¬",q:"Ø§Ù„ÙƒÙ…ÙŠØ©",pr:"Ø§Ù„Ø³Ø¹Ø±",t:"Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹",tot:"Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ"},
fr:{title:"ğŸ’³ Ventes",items:"Articles",p:"Produit",q:"QtÃ©",pr:"Prix",t:"Total",tot:"Total gÃ©nÃ©ral"},
en:{title:"ğŸ’³ Sales",items:"Items",p:"Product",q:"Qty",pr:"Price",t:"Total",tot:"Grand Total"}
};
function setLang(l){
    document.body.dir = l==="ar"?"rtl":"ltr";
    document.getElementById("title").textContent = words[l].title;
    itemsLabel.textContent = words[l].items;
    p.textContent = words[l].p;
    q.textContent = words[l].q;
    pr.textContent = words[l].pr;
    t.textContent = words[l].t;
    totalLabel.textContent = words[l].tot;
}

// ===== ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase =====
db.ref("stock").on("value", snap => {
    stock = snap.val() || [];
    renderCategories();
    if(currentCat) showProducts(currentCat);
});
db.ref("salesHistory").on("value", snap => {
    salesHistory = snap.val() || [];
    renderStats();
});

// ===== Ø¹Ø±Ø¶ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª =====
function renderCategories(){
    const catsDiv = document.getElementById("categories");
    catsDiv.innerHTML="";
    const allCats = [...new Set(stock.map(p=>p.category))];
    allCats.forEach(c=>{
        const d = document.createElement("div");
        d.className="cat";
        d.textContent = c;
        d.onclick = ()=>{ currentCat=c; showProducts(c); };
        catsDiv.appendChild(d);
    });
}

// ===== Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª =====
function showProducts(cat){
    const prodDiv = document.getElementById("products");
    prodDiv.innerHTML="";
    stock.filter(p=>p.category===cat && p.qtyLeft>0).forEach(p=>{
        const d = document.createElement("div");
        d.className="product";
        d.innerHTML = `
            <img src="${p.image}">
            <span>${p.name}</span>
            <b>${p.sell} Ø¯Ø¬</b>
            <div class="stockLabel">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${p.qtyLeft}</div>
        `;
        d.onclick = ()=>addToCart(p);
        prodDiv.appendChild(d);
    });
}

// ===== Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø³Ù„Ø© Ø§Ù„Ø¨ÙŠØ¹ =====
function addToCart(p){
    let f = cart.find(i=>i.name===p.name && i.category===p.category);
    if(f){
        if(f.qty < p.qtyLeft) f.qty++;
        else alert("ğŸš« Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙ…ÙŠØ© ÙƒØ§ÙÙŠØ© ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†");
    } else {
        let item = {...p, qty:1};
        cart.push(item);
    }
    renderCart();
}

// ===== Ø±Ø³Ù… Ø§Ù„Ø³Ù„Ø© =====
function renderCart(){
    const tbody = document.getElementById("cart");
    tbody.innerHTML="";
    let sum = 0;
    cart.forEach((i,n)=>{
        let tot = i.qty*i.sell;
        sum += tot;
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${i.name} (Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${i.qtyLeft - i.qty})</td>
            <td><input type="number" value="${i.qty}" min="1" max="${i.qtyLeft}" onchange="cart[${n}].qty=Math.min(this.value,${i.qtyLeft});renderCart()"></td>
            <td><input type="number" value="${i.sell}" min="0" onchange="cart[${n}].sell=+this.value;renderCart()"></td>
            <td>${tot}</td>
            <td><button class="del" onclick="cart.splice(${n},1);renderCart()">âœ–</button></td>
        `;
        tbody.appendChild(tr);
    });
    total.textContent = sum + " Ø¯Ø¬";
}

// ===== ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨ÙŠØ¹ Ù…Ø¹ ØªØ­Ø¯ÙŠØ« Firebase =====
function confirmSale(){
    if(cart.length===0){ alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ± ÙÙŠ Ø§Ù„Ø³Ù„Ø©"); return; }
    const today = new Date().toISOString();

    cart.forEach(c=>{
        const prodIndex = stock.findIndex(p=>p.name===c.name && p.category===c.category);
        if(prodIndex!==-1){
            stock[prodIndex].qtyLeft -= c.qty;
            salesHistory.push({...c, date: today});
        }
    });

    // ØªØ­Ø¯ÙŠØ« Firebase
    db.ref("stock").set(stock);
    db.ref("salesHistory").set(salesHistory);

    alert("âœ… ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨ÙŠØ¹ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ†");
    cart=[];
    renderCart();
    renderCategories();
    if(currentCat) showProducts(currentCat);
    renderStats();
}

// ===== Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« =====
const searchBox = document.getElementById("searchBox");
searchBox.addEventListener("input",()=>{
    const term = searchBox.value.trim().toLowerCase();
    const prodDiv = document.getElementById("products");
    prodDiv.innerHTML="";
    if(term===""){ if(currentCat) showProducts(currentCat); return; }
    stock.filter(p=>p.name.toLowerCase().startsWith(term) && p.qtyLeft>0).forEach(p=>{
        const d = document.createElement("div");
        d.className="product";
        d.innerHTML = `
            <img src="${p.image}">
            <span>${p.name}</span>
            <b>${p.sell} Ø¯Ø¬</b>
            <div class="stockLabel">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${p.qtyLeft}</div>
        `;
        d.onclick = ()=>addToCart(p);
        prodDiv.appendChild(d);
    });
});

// ===== Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª =====
function renderStats(){
    const now = new Date();
    const daily = salesHistory.filter(s=>new Date(s.date).toDateString()===now.toDateString());
    const weekStart = new Date(now); weekStart.setDate(now.getDate()-now.getDay());
    const weekly = salesHistory.filter(s=>new Date(s.date)>=weekStart);
    const monthly = salesHistory.filter(s=>{
        const d = new Date(s.date);
        return d.getMonth()===now.getMonth() && d.getFullYear()===now.getFullYear();
    });

    function calcProfit(arr){
        let raw=0, net=0;
        arr.forEach(s=>{ raw+=s.sell*s.qty; net+=(s.sell-s.buy)*s.qty; });
        return {raw,net};
    }

    const dProfit = calcProfit(daily);
    const wProfit = calcProfit(weekly);
    const mProfit = calcProfit(monthly);

    document.getElementById("dailyProfit").textContent=`Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ØµØ§ÙÙŠ: ${dProfit.net} Ø¯Ø¬ | Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø®Ø§Ù…: ${dProfit.raw} Ø¯Ø¬`;
    document.getElementById("weeklyProfit").textContent=`Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ØµØ§ÙÙŠ: ${wProfit.net} Ø¯Ø¬ | Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø®Ø§Ù…: ${wProfit.raw} Ø¯Ø¬`;
    document.getElementById("monthlyProfit").textContent=`Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ØµØ§ÙÙŠ: ${mProfit.net} Ø¯Ø¬ | Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø®Ø§Ù…: ${mProfit.raw} Ø¯Ø¬`;
}

setLang("ar");
renderCart();
renderStats();
</script>

</body>
</html>
