<!DOCTYPE html>
<html lang="ar">
<head>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#28a745">
<meta charset="UTF-8">
<title>Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</title>

<style>
body{
    font-family:Arial;
    direction:rtl;
    background:#f4f6f8;
    margin:0;
}
header{
    background:#198754;
    color:white;
    padding:18px;
    text-align:center;
    font-size:28px;
    font-weight:bold;
}

/* Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­ÙƒÙ… */
.controls{
    display:flex;
    gap:10px;
    padding:15px;
    justify-content:center;
    flex-wrap:wrap;
}
.controls input, .controls button{
    padding:10px;
    font-size:16px;
    border-radius:6px;
    border:1px solid #ccc;
}
.controls button{
    background:#dc3545;
    color:white;
    cursor:pointer;
    border:none;
}

/* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
.cards{
    display:flex;
    justify-content:center;
    gap:20px;
    margin:15px;
}
.card{
    width:260px;
    padding:20px;
    border-radius:12px;
    color:white;
    font-size:20px;
    text-align:center;
}
.green{background:#28a745;}
.blue{background:#0d6efd;}

/* Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
table{
    width:95%;
    margin:auto;
    border-collapse:collapse;
    background:white;
}
th,td{
    border:1px solid #ddd;
    padding:10px;
    text-align:center;
    font-size:15px;
}
th{
    background:#198754;
    color:white;
}
.btn{
    padding:5px 8px;
    border:none;
    border-radius:5px;
    cursor:pointer;
    color:white;
}
.del{background:#dc3545;}
.edit{background:#0d6efd;}
</style>
</head>

<body>

<header>ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</header>

<!-- Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­ÙƒÙ… -->
<div class="controls">
    <input type="date" id="searchDate">
    <button onclick="resetToday()">ğŸ†• Ø¨Ø¯Ø¡ ÙŠÙˆÙ… Ø¬Ø¯ÙŠØ¯</button>
</div>

<!-- Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ -->
<div class="cards">
    <div class="card green">
        Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø®Ø§Ù…<br>
        <span id="gross">0</span> Ø¯Ø¬
    </div>
    <div class="card blue">
        Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ØµØ§ÙÙŠ<br>
        <span id="net">0</span> Ø¯Ø¬
    </div>
</div>

<!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
<table>
<thead>
<tr>
<th>ØªØ­Ø¯ÙŠØ¯</th>
<th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
<th>Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø®Ø§Ù…</th>
<th>Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ØµØ§ÙÙŠ</th>
<th>Ø­Ø°Ù</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

<script>
// ===============================
// ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
// ===============================
let sales = JSON.parse(localStorage.getItem("sales")) || [];
let stats = JSON.parse(localStorage.getItem("stats")) || [];
const tbody = document.getElementById("tbody");

// ===============================
// Ø­Ø³Ø§Ø¨ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…
// ===============================
function calculateStats(){
    const today = new Date().toISOString().split("T")[0];

    let gross=0, net=0;

    sales.filter(s=>s.date===today).forEach(s=>{
        gross += s.sell * s.qty;
        net += (s.sell - s.buy) * s.qty;
    });

    const exists = stats.find(s=>s.date===today);
    if(!exists){
        stats.push({date:today, gross, net});
        localStorage.setItem("stats",JSON.stringify(stats));
    }

    render();
}

// ===============================
// Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„
// ===============================
function render(filterDate=""){
    tbody.innerHTML="";
    let g=0,n=0;

    stats.forEach((s,i)=>{
        if(filterDate && s.date!==filterDate) return;

        g+=s.gross;
        n+=s.net;

        const tr=document.createElement("tr");
        tr.innerHTML=`
<td><input type="checkbox" class="compare" data-index="${i}"></td>
<td>${s.date}</td>
<td contenteditable onblur="edit(${i},'gross',this.innerText)">${s.gross}</td>
<td contenteditable onblur="edit(${i},'net',this.innerText)">${s.net}</td>
<td><button class="btn del" onclick="del(${i})">âŒ</button></td>
        `;
        tbody.appendChild(tr);
    });

    document.getElementById("gross").textContent=g;
    document.getElementById("net").textContent=n;
}

// ===============================
// ØªØ¹Ø¯ÙŠÙ„
// ===============================
function edit(i,key,val){
    stats[i][key]=Number(val);
    localStorage.setItem("stats",JSON.stringify(stats));
    render(document.getElementById("searchDate").value);
}

// ===============================
// Ø­Ø°Ù
// ===============================
function del(i){
    if(confirm("Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ… Ù…Ù† Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§ØªØŸ")){
        stats.splice(i,1);
        localStorage.setItem("stats",JSON.stringify(stats));
        render();
    }
}

// ===============================
// Ø¨Ø¯Ø¡ ÙŠÙˆÙ… Ø¬Ø¯ÙŠØ¯
// ===============================
function resetToday(){
    if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¨Ø¯Ø¡ ÙŠÙˆÙ… Ø¬Ø¯ÙŠØ¯ØŸ")){
        sales=[];
        localStorage.setItem("sales",JSON.stringify([]));
        alert("ØªÙ… Ø¨Ø¯Ø¡ ÙŠÙˆÙ… Ø¬Ø¯ÙŠØ¯");
    }
}

// ===============================
// Ø§Ù„Ø¨Ø­Ø« Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ®
// ===============================
document.getElementById("searchDate").addEventListener("change",function(){
    render(this.value);
});

// ØªØ­Ù…ÙŠÙ„
calculateStats();
render();
</script>

</body>
</html>
